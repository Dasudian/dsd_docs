<!DOCTYPE html>
<html lang="zh">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="大数点物联网开发者平台文档，基于大数点物联网平台，帮助开发者快速构建物联网应用">
    <title>Schema Design</title>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/app.css" rel="stylesheet">
    <link href="/css/doc.css" rel="stylesheet">
    <link href="//cdn.bootcss.com/highlight.js/9.2.0/styles/dark.min.css" rel="stylesheet">
    <script src="/js/jquery.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/common.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script>
    <script>
      $(function() {
        // $(".document .side_left ul li a").click(function() {
        //   $(".document .side_left ul li a").removeClass("active");
        //   $(this).addClass("active");
        // })
        $(".menu1>li>a.fold").click(function(){
				  $(".menu1 a.fold").css("background-image","url(/images/number_down.png)");
				  $(".menu2,.menu3").slideUp();
			  })
			  $(".menu2>li>a.fold").click(function(){
          $(".menu2 a.fold").css("background-image","url(/images/number_down.png)");
          $(".menu3").slideUp();
        })
        $(".fold").click(function() {
          if ($(this).next("ul").is(":hidden")) {
            $(this).css("background-image", "url(/images/number_up.png)");
            $(this).next("ul").slideDown();
          } else {
            $(this).css("background-image", "url(/images/number_down.png)");
            $(this).next("ul").slideUp();
          }
        })
      })
      $(function(){
			  $(".side_right").scroll( function() { 
				  var scrollValue=$(".side_right").scrollTop();
				  scrollValue > 100 ? $('div[class=scroll]').fadeIn():$('div[class=scroll]').fadeOut();
			  });	
			  $('#scroll').click(function(){
				  $(".side_right").animate({scrollTop:0},200);	
			  });	
		  })
    </script>
    <link href='//fonts.useso.com/css?family=Open+Sans:300|Source+Code+Pro:400' rel='stylesheet' type='text/css'>
  </head>

  <body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://dev.dasudian.com"><img src="/images/logo.png"/></a>
        </div>

        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="http://dasudian.com/datahub" >IoT Data Hub</a></li>
            <li><a href="http://dasudian.com/product_service" >产品服务</a></li>
            <li><a href="/" >文档</a></li>
            <li><a href="http://dasudian.com/price" >定价</a></li>
            <li><a href="https://www.github.com/Dasudian"  target="_blank" >社区</a></li>
            <li><a href="https://dev.dasudian.com/login/view" class="btn-small">登录</a></li>
            <li><a href="https://dev.dasudian.com/sign_up/view" class="btn-small">注册</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container-fluid0 document">
      <div class="side_left">
        <ul class="menu1">
          <li><a class="fold">服务集成指南</a>
            <ul class="menu2" >
              <li><a id="srvintegrate-index" class="" href="/integration-dev/index.html">服务集成</a></li>
              <li><a class="fold">IM即时消息服务</a>
                <ul class="menu3" >
                  <li><a id="srvintegrate-im-android" class="" href="/integration-dev/im/integrate-im-android.html">Android上集成IM功能</a></li>
                  <li><a id="srvintegrate-im-ios" class="" href="/integration-dev/im/integrate-im-ios.html">iOS上集成IM功能</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><a class="fold">DS Database</a>
            <ul class="menu2" style="display: block;">
              <li><a id="dsdb-overview" class="" href="/dsdb/index.html">DSDB Overview</a></li>
              <li><a class="fold">Introduction</a>
                <ul class="menu3" >
                  <li><a id="dsdb-intro-overview" class="" href="/dsdb/introduction/index.html">Overview</a></li>
                  <li><a id="dsdb-intro-installation" class="" href="/dsdb/introduction/installation.html">Installation</a></li>
                  <li><a id="dsdb-intro-start" class="" href="/dsdb/introduction/getting_started.html">Getting Started</a></li>
                </ul>
              </li>
              <li><a class="fold">Administration</a>
                <ul class="menu3" >
                  <li><a id="dsdb-admin-overview" class="" href="/dsdb/administration/index.html">administration Overview</a></li>
                  <li><a id="dsdb-authent&amp;authori" class="" href="/dsdb/administration/authentication_and_authorization.html">Authentication&Authorization</a></li>
                  <li><a id="dsdb-backup&amp;restore" class="" href="/dsdb/administration/backup_and_restore.html">Backup&Restore</a></li>
                  <li><a id="dsdb-configuration" class="" href="/dsdb/administration/config.html">Configuration</a></li>
                  <li><a id="dsdb-logs" class="" href="/dsdb/administration/logs.html">Logs</a></li>
                  <li><a id="dsdb-monitoring" class="" href="/dsdb/administration/statistics.html">Server Monitoring</a></li>
                  <li><a id="dsdb-upgrade" class="" href="/dsdb/administration/upgrading.html">Upgrading</a></li>
                </ul>
              </li>
              <li><a class="fold">Clients</a>
                <ul class="menu3" >
                  <li><a id="dsdb-clients-overview" class="" href="/dsdb/clients/index.html">Clients Overview</a></li>
                  <li><a id="dsdb-clients-httpapi" class="" href="/dsdb/clients/api.html">HTTP API</a></li>
                </ul>
              </li>
              <li><a class="fold">Concepts</a>
                <ul class="menu3" style="display: block;">
                  <li><a id="dsdb-concepts-overview" class="" href="/dsdb/concepts/index.html">Concepts Overview</a></li>
                  <li><a id="dsdb-key-concepts" class="" href="/dsdb/concepts/key_concepts.html">Key Concepts</a></li>
                  <li><a id="dsdb-concepts-arch" class="" href="/dsdb/concepts/how_dsdb_works.html">Architecture</a></li>
                  <li><a id="dsdb-concepts-schema-data-layout" class="active" href="/dsdb/concepts/schema_and_data_layout.html">Scheam Design</a></li>
                  <li><a id="dsdb-concepts-insights-tradeoffs" class="" href="/dsdb/concepts/insights_tradeoffs.html">Insights Tradeoffs</a></li>
                  <li><a id="dsdb-concepts-api-endpoints" class="" href="/dsdb/concepts/api.html">API Endpoints&Ports</a></li>
                  <li><a id="dsdb-concepts-storage-engine" class="" href="/dsdb/concepts/storage_engine.html">Storage Engine</a></li>
                  <li><a id="dsdb-concepts-glossary" class="" href="/dsdb/concepts/glossary.html">Glossary of Terms</a></li>
                  <li><a id="dsdb-concepts-vs-sql" class="" href="/dsdb/concepts/crosswalk.html">Comparison to SQL</a></li>
                </ul>
              </li>
              <li><a class="fold">Data Sources</a>
                <ul class="menu3" >
                  <li><a id="dsdb-datasource-diamond" class="" href="/dsdb/data_sources/diamond.html">Diamond</a></li>
                  <li><a id="dsdb-datasource-opentsdb" class="" href="/dsdb/data_sources/opentsdb.html">OpenTSDB</a></li>
                </ul>
              </li>
              <li><a class="fold">Guides</a>
                <ul class="menu3" >
                  <li><a id="dsdb-guides-clustering" class="" href="/dsdb/guides/clustering.html">Clustering</a></li>
                  <li><a id="dsdb-guides-ddr" class="" href="/dsdb/guides/downsampling_and_retention.html">Downsampling and Data Retention</a></li>
                  <li><a id="dsdb-guides-hsg" class="" href="/dsdb/guides/hardware_sizing.html">Hardware Sizing Guidelines</a></li>
                  <li><a id="dsdb-guides-querying" class="" href="/dsdb/guides/querying_data.html">Querying Data</a></li>
                  <li><a id="dsdb-guides-writing" class="" href="/dsdb/guides/writing_data.html">Writing Data</a></li>
                </ul>
              </li>
              <li><a class="fold">Query Language</a>
                <ul class="menu3" >
                  <li><a id="dsdb-querylang-overview" class="" href="/dsdb/query_language/index.html">Overview</a></li>
                  <li><a id="dsdb-querylang-dataexp" class="" href="/dsdb/query_language/data_exploration.html">Data Exploration</a></li>
                  <li><a id="dsdb-querylang-scheamexp" class="" href="/dsdb/query_language/schema_exploration.html">Schema Exploration</a></li>
                  <li><a id="dsdb-querylang-func" class="" href="/dsdb/query_language/functions.html">Functions</a></li>
                  <li><a id="dsdb-querylang-contq" class="" href="/dsdb/query_language/continuous_queries.html">Continuous Queries</a></li>
                  <li><a id="dsdb-querylang-spec" class="" href="/dsdb/query_language/spec.html">Query Language Reference</a></li>
                  <li><a id="dsdb-querylang-mgmt" class="" href="/dsdb/query_language/database_management.html">Database Management</a></li>
                  <li><a id="dsdb-querylang-math" class="" href="/dsdb/query_language/math_operators.html">Mathematical Operators</a></li>
                </ul>
              </li>
              <li><a class="fold">Sample Data</a>
                <ul class="menu3" >
                  <li><a id="dsdb-sampledata-down" class="" href="/dsdb/sample_data/data_download.html">Sample Data Download</a></li>
                </ul>
              </li>
              <li><a class="fold">Tools</a>
                <ul class="menu3" >
                  <li><a id="dsdb-tools-overview" class="" href="/dsdb/tools/index.html">Tools Overview</a></li>
                  <li><a id="dsdb-tools-shell" class="" href="/dsdb/tools/shell.html">CLI/Shell</a></li>
                  <li><a id="dsdb-tools-webadmin" class="" href="/dsdb/tools/web_admin.html">Web Admin Interface</a></li>
                </ul>
              </li>
              <li><a class="fold">Write Protocols</a>
                <ul class="menu3" >
                  <li><a id="dsdb-writepro-overview" class="" href="/dsdb/write_protocols/index.html">Overview</a></li>
                  <li><a id="dsdb-writepro-line" class="" href="/dsdb/write_protocols/line.html">Line Protocol</a></li>
                  <li><a id="dsdb-writepro-syntax" class="" href="/dsdb/write_protocols/write_syntax.html">Write Syntax</a></li>
                  <li><a id="dsdb-writepro-json" class="" href="/dsdb/write_protocols/json.html">JSON Protocol</a></li>
                  <li><a id="dsdb-writepro-udp" class="" href="/dsdb/write_protocols/udp.html">Service - UDP</a></li>
                  <li><a id="dsdb-writepro-graphite" class="" href="/dsdb/write_protocols/graphite.html">Service - Graphite</a></li>
                  <li><a id="dsdb-writepro-opentsdb" class="" href="/dsdb/write_protocols/opentsdb.html">Servcie - OpenTSDB</a></li>
                  <li><a id="dsdb-writepro-collectd" class="" href="/dsdb/write_protocols/collectd.html">Service - CollectD</a></li>
                </ul>
              </li>
              <li><a class="fold">Troubleshooting</a>
                <ul class="menu3" >
                  <li><a id="dsdb-troubleshoot-overview" class="" href="/dsdb/troubleshooting/index.html">Troubleshooting Overview</a></li>
                  <li><a id="dsdb-troubleshoot-fei" class="" href="/dsdb/troubleshooting/frequently_encountered_issues.html">Frequently Encountered Issues</a></li>
                  <li><a id="dsdb-troubleshoot-monitor" class="" href="/dsdb/troubleshooting/system_monitoring.html">System Monitoring</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><a class="fold">DSD API Container(DAC)</a>
            <ul class="menu2" >
              <li><a id="dac-principal" class="" href="/dac/index.html">DAC介绍</a></li>
              <li><a id="dac-java-api" class="" href="/dac/dac_cloud_api_java.html">DAC Java API</a></li>
              <li><a id="dac-c-api" class="" href="/dac/dac_cloud_api_c.html">DAC C API</a></li>
              <li><a id="dac-cpp-api" class="" href="/dac/dac_cloud_api_cpp.html">DAC C++ API</a></li>
            </ul>
          </li>
          <li><a class="fold">Data Hub</a>
            <ul class="menu2" >
              <li><a id="datahub-index" class="" href="/datahub/index.html">Data Hub Overview</a></li>
              <li><a class="fold">SDK</a>
                <ul class="menu3" >
                  <li><a id="datahub-sdk-js" class="" href="/datahub/sdk/javascript.html">JavaScript</a></li>
                  <li><a id="datahub-sdk-embededc" class="" href="/datahub/sdk/embeded_c.html">Embeded C</a></li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
    </div>

    <div class="side_right">
      <div class="doc">
        <h1 id="scheam-design">Scheam Design</h1>
<p>Every DSDB use case is special and your <a href="/dsdb/concepts/glossary.html#schema">schema</a> will reflect that uniqueness.
There are, however, general guidelines to follow and pitfalls to avoid when designing your schema.</p>
<h2 id="encouraged-schema-design">Encouraged Schema Design</h2>
<p>In no particular order, we recommend that you:</p>
<ul>
<li>
<p><em>Encode meta data in tags</em></p>
<p><a href="/dsdb/concepts/glossary.html#tag">Tags</a> are indexed and <a href="/dsdb/concepts/glossary.html#field">fields</a> are not indexed.
This means that queries on tags are more performant than those on fields.</p>
<p>In general, your queries should guide what gets stored as a tag and what gets stored as a field:</p>
<ul>
<li>Store data in tags if they're commonly-queried meta data</li>
<li>Store data in tags if you plan to use them with <code>GROUP BY()</code></li>
<li>Store data in fields if you plan to use them with an <a href="/dsdb/query_language/functions.html">InfluxQL function</a></li>
<li>Store data in fields if you <em>need</em> them to be something other than a string - <a href="/dsdb/concepts/glossary.html#tag-value">tag values</a> are always interpreted as strings</li>
</ul>
</li>
<li>
<p><em>Avoid using InfluxQL Keywords as identifier names</em></p>
<p>This isn't necessary, but it simplifies writing queries; you won't have to wrap those identifiers in double quotes.
Identifiers are are database names, <a href="/dsdb/concepts/glossary.html#retention-policy-rp">retention policy</a> names, <a href="/dsdb/concepts/glossary.html#user">user</a> names, <a href="/dsdb/concepts/glossary.html#measurement">measurement</a> names, <a href="/dsdb/concepts/glossary.html#tag-key">tag keys</a>, and <a href="/dsdb/concepts/glossary.html#field-key">field keys</a>.
See <a href="https://github.com/dasudian/dsdb/blob/master/dsdbql/influxql.html#keywords">InfluxQL Keywords</a> for words to avoid.</p>
<p>Note that you will also need to wrap identifiers in double quotes in queries if they contain characters other than <code>[A-z,_]</code>.</p>
</li>
</ul>
<h2 id="discouraged-schema-design">Discouraged Schema Design</h2>
<p>In no particular order, we recommend that you:</p>
<ul>
<li>
<p><em>Don't have too many series</em></p>
<p>See <a href="/dsdb/guides/hardware_sizing.html#general-hardware-guidelines-for-a-single-node">Hardware Sizing Guidelines</a> for <a href="/dsdb/concepts/glossary.html#series-cardinality">series cardinality</a> recommendations based on your hardware.</p>
<p><a href="/dsdb/concepts/glossary.html#tag">Tags</a> that specify highly variable information like UUIDs, hashes, and random strings can increase your series cardinality to uncomfortable levels.
If you need that information in your database, consider storing the high-cardinality data as a field rather than a tag (note that query performance will be slower).</p>
</li>
<li>
<p><em>Don't differentiate data with measurement names</em></p>
<p>In general, taking this step will simplify your queries.
DSDB queries merge data that fall within the same <a href="/dsdb/concepts/glossary.html#measurement">measurement</a>; it's better to differentiate data with <a href="/dsdb/concepts/glossary.html#tag">tags</a> than with detailed measurement names.</p>
<p>Example:</p>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: left;">Schema 1</th>
<th style="text-align: left;">Schema 2</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><em>Measurement:</em> <code>blueberries.field-1.region-north</code></td>
<td style="text-align: left;"><em>Measurement:</em> <code>blueberries</code>; <em>Tags:</em> <code>field = 1</code> and <code>region = north</code></td>
</tr>
<tr>
<td style="text-align: left;"><em>Measurement:</em>  <code>blueberries.field-2.region-midwest</code></td>
<td style="text-align: left;"><em>Measurement:</em> <code>blueberries</code>; <em>Tags:</em> <code>field = 2</code> and <code>region = midwest</code></td>
</tr>
</tbody>
</table>
<pre><code>Assume that each measurement contains a single field key called `value`.
The following queries calculate the average of `value` across all fields and all regions.
Notice that, even at this small scale, this is harder to do under Schema 1.

*Schema 1*
```
&gt; SELECT mean(value) FROM /^blueberries/
name: blueberries.field-1.region-north
--------------------------------------
time                    mean
1970-01-01T00:00:00Z    444

name: blueberries.field-2.region-midwest
----------------------------------------
time                    mean
1970-01-01T00:00:00Z    33766.666666666664
```
Then calculate the mean yourself.

*Schema 2*
```
&gt; SELECT mean(value) FROM blueberries
name: blueberries
-----------------
time                    mean
1970-01-01T00:00:00Z    17105.333333333332
```</code></pre>
<ul>
<li>
<p><em>Don't put more than one piece of information in one tag</em></p>
<p>Similar to the point above, taking this step will simplify your queries.
It will reduce your need for regular expressions.</p>
<p>Example:</p>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: left;">Tagset 1</th>
<th style="text-align: left;">Tagset 2</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>location = field-1.region-north</code></td>
<td style="text-align: left;"><code>field = 1</code> and <code>region = north</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>location = field-2.region-north</code></td>
<td style="text-align: left;"><code>field = 2</code> and <code>region = north</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>location = field-2.region-midwest</code></td>
<td style="text-align: left;"><code>field = 2</code> and <code>region = north</code></td>
</tr>
</tbody>
</table>
<pre><code>Assume that each [tag set](/dsdb/concepts/glossary.html#tag-set) falls in the [measurement](/dsdb/concepts/glossary.html#measurement) `blueberries` and is associated with a [field](/dsdb/concepts/glossary.html#field) called `value`.
The following queries calculate the average of `value` for blueberries that fall in the `north`.
While both queries are relatively simple, you can imagine that the regex could get much more complicated if Schema 1 contained a more complex tag value.

*Schema 1*
```
&gt; SELECT mean(value) FROM blueberries WHERE location =~ /north/
```

*Schema 2*
```
&gt; SELECT mean(value) FROM blueberries WHERE region = 'north'
```</code></pre>
<ul>
<li>
<p><em>Don't use the same name for a field key and tag key</em></p>
<p>You won't be able to query the <a href="/dsdb/concepts/glossary.html#tag-key">tag key</a> if the tag key is the same as a <a href="/dsdb/concepts/glossary.html#field-key">field key</a> in your schema.
Be sure to differentiate your tag keys and field keys.</p>
<dt>
See GitHub Issue [#4630](https://github.com/dasudian/dsdb/issues/4630) for more information.
</dt>
</li>
</ul>
      </div>

              <div class="tract"><img src="/images/tract.png"/></div>
            <div class="clearfix"></div>
      <div class="scroll" id="scroll" style="display:none;">
			     <img src="/images/top.png"/>
		  </div>
    </div>
  </div>
  <script>hljs.initHighlightingOnLoad();</script>
</body>

</html>
