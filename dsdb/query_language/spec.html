<!DOCTYPE html>
<html lang="zh">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="大数点物联网开发者平台文档，基于大数点物联网平台，帮助开发者快速构建物联网应用">
    <title>Query Language Reference</title>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/app.css" rel="stylesheet">
    <link href="//cdn.bootcss.com/highlight.js/9.2.0/styles/dark.min.css" rel="stylesheet">
    <script src="/js/jquery.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/common.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script>
    <script>
      $(function() {
        // $(".document .side_left ul li a").click(function() {
        //   $(".document .side_left ul li a").removeClass("active");
        //   $(this).addClass("active");
        // })
        $(".menu1>li>a.fold").click(function(){
				  $(".menu1 a.fold").css("background-image","url(/images/number_down.png)");
				  $(".menu2,.menu3").slideUp();
			  })
			  $(".menu2>li>a.fold").click(function(){
          $(".menu2 a.fold").css("background-image","url(/images/number_down.png)");
          $(".menu3").slideUp();
        })
        $(".fold").click(function() {
          if ($(this).next("ul").is(":hidden")) {
            $(this).css("background-image", "url(/images/number_up.png)");
            $(this).next("ul").slideDown();
          } else {
            $(this).css("background-image", "url(/images/number_down.png)");
            $(this).next("ul").slideUp();
          }
        })
      })
      $(function(){
			  $(".side_right").scroll( function() { 
				  var scrollValue=$(".side_right").scrollTop();
				  scrollValue > 100 ? $('div[class=scroll]').fadeIn():$('div[class=scroll]').fadeOut();
			  });	
			  $('#scroll').click(function(){
				  $(".side_right").animate({scrollTop:0},200);	
			  });	
		  })
    </script>
    <link href='http://fonts.useso.com/css?family=Open+Sans:300|Source+Code+Pro:400' rel='stylesheet' type='text/css'>
  </head>

  <body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><img src="/images/logo.png"/></a>
        </div>

        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="http://dasudian.com/solution" >解决方案</a></li>
            <li><a href="/" >文档</a></li>
            <li><a href="http://dasudian.com/price" >定价</a></li>
            <li><a href="https://www.github.com/Dasudian"  target="_blank" >社区</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container-fluid0 document">
      <div class="side_left">
        <ul class="menu1">
          <li><a class="fold">服务集成指南</a>
            <ul class="menu2" >
              <li><a id="srvintegrate-im-android" class="" href="/integration-dev/integrate-im-android.html">Android上集成IM功能</a></li>
              <li><a id="srvintegrate-im-ios" class="" href="/integration-dev/integrate-im-ios.html">iOS上集成IM功能</a></li>
            </ul>
          </li>
          <li><a class="fold">DS Database</a>
            <ul class="menu2" style="display: block;">
              <li><a id="dsdb-overview" class="" href="/dsdb/index.html">DSDB Overview</a></li>
              <li><a class="fold">Introduction</a>
                <ul class="menu3" >
                  <li><a id="dsdb-intro-overview" class="" href="/dsdb/introduction/index.html">Overview</a></li>
                  <li><a id="dsdb-intro-installation" class="" href="/dsdb/introduction/installation.html">Installation</a></li>
                  <li><a id="dsdb-intro-start" class="" href="/dsdb/introduction/getting_started.html">Getting Started</a></li>
                </ul>
              </li>
              <li><a class="fold">Administration</a>
                <ul class="menu3" >
                  <li><a id="dsdb-admin-overview" class="" href="/dsdb/administration/index.html">administration Overview</a></li>
                  <li><a id="dsdb-authent&amp;authori" class="" href="/dsdb/administration/authentication_and_authorization.html">Authentication&Authorization</a></li>
                  <li><a id="dsdb-backup&amp;restore" class="" href="/dsdb/administration/backup_and_restore.html">Backup&Restore</a></li>
                  <li><a id="dsdb-configuration" class="" href="/dsdb/administration/config.html">Configuration</a></li>
                  <li><a id="dsdb-logs" class="" href="/dsdb/administration/logs.html">Logs</a></li>
                  <li><a id="dsdb-monitoring" class="" href="/dsdb/administration/statistics.html">Server Monitoring</a></li>
                  <li><a id="dsdb-upgrade" class="" href="/dsdb/administration/upgrading.html">Upgrading</a></li>
                </ul>
              </li>
              <li><a class="fold">Clients</a>
                <ul class="menu3" >
                  <li><a id="dsdb-clients-overview" class="" href="/dsdb/clients/index.html">Clients Overview</a></li>
                  <li><a id="dsdb-clients-httpapi" class="" href="/dsdb/clients/api.html">HTTP API</a></li>
                </ul>
              </li>
              <li><a class="fold">Concepts</a>
                <ul class="menu3" >
                  <li><a id="dsdb-concepts-overview" class="" href="/dsdb/concepts/index.html">Concepts Overview</a></li>
                  <li><a id="dsdb-key-concepts" class="" href="/dsdb/concepts/key_concepts.html">Key Concepts</a></li>
                  <li><a id="dsdb-concepts-arch" class="" href="/dsdb/concepts/how_dsdb_works.html">Architecture</a></li>
                  <li><a id="dsdb-concepts-schema-data-layout" class="" href="/dsdb/concepts/schema_and_data_layout.html">Scheam Design</a></li>
                  <li><a id="dsdb-concepts-insights-tradeoffs" class="" href="/dsdb/concepts/insights_tradeoffs.html">Insights Tradeoffs</a></li>
                  <li><a id="dsdb-concepts-api-endpoints" class="" href="/dsdb/concepts/api.html">API Endpoints&Ports</a></li>
                  <li><a id="dsdb-concepts-storage-engine" class="" href="/dsdb/concepts/storage_engine.html">Storage Engine</a></li>
                  <li><a id="dsdb-concepts-glossary" class="" href="/dsdb/concepts/glossary.html">Glossary of Terms</a></li>
                  <li><a id="dsdb-concepts-vs-sql" class="" href="/dsdb/concepts/crosswalk.html">Comparison to SQL</a></li>
                </ul>
              </li>
              <li><a class="fold">Data Sources</a>
                <ul class="menu3" >
                  <li><a id="dsdb-datasource-diamond" class="" href="/dsdb/data_sources/diamond.html">Diamond</a></li>
                  <li><a id="dsdb-datasource-opentsdb" class="" href="/dsdb/data_sources/opentsdb.html">OpenTSDB</a></li>
                  <li><a id="dsdb-datasource-carbon" class="" href="/dsdb/data_sources/carbon.html">Carbon</a></li>
                  <li><a id="dsdb-datasource-collectd" class="" href="/dsdb/data_sources/collectd.html">Collectd</a></li>
                </ul>
              </li>
              <li><a class="fold">Guides</a>
                <ul class="menu3" >
                  <li><a id="dsdb-guides-clustering" class="" href="/dsdb/guides/clustering.html">Clustering</a></li>
                  <li><a id="dsdb-guides-ddr" class="" href="/dsdb/guides/downsampling_and_retention.html">Downsampling and Data Retention</a></li>
                  <li><a id="dsdb-guides-hsg" class="" href="/dsdb/guides/hardware_sizing.html">Hardware Sizing Guidelines</a></li>
                  <li><a id="dsdb-guides-querying" class="" href="/dsdb/guides/querying_data.html">Querying Data</a></li>
                  <li><a id="dsdb-guides-writing" class="" href="/dsdb/guides/writing_data.html">Writing Data</a></li>
                </ul>
              </li>
              <li><a class="fold">Query Language</a>
                <ul class="menu3" style="display: block;">
                  <li><a id="dsdb-querylang-overview" class="" href="/dsdb/query_language/index.html">Overview</a></li>
                  <li><a id="dsdb-querylang-dataexp" class="" href="/dsdb/query_language/data_exploration.html">Data Exploration</a></li>
                  <li><a id="dsdb-querylang-scheamexp" class="" href="/dsdb/query_language/schema_exploration.html">Schema Exploration</a></li>
                  <li><a id="dsdb-querylang-func" class="" href="/dsdb/query_language/functions.html">Functions</a></li>
                  <li><a id="dsdb-querylang-contq" class="" href="/dsdb/query_language/continuous_queries.html">Continuous Queries</a></li>
                  <li><a id="dsdb-querylang-spec" class="active" href="/dsdb/query_language/spec.html">Query Language Reference</a></li>
                  <li><a id="dsdb-querylang-mgmt" class="" href="/dsdb/query_language/database_management.html">Database Management</a></li>
                  <li><a id="dsdb-querylang-math" class="" href="/dsdb/query_language/math_operators.html">Mathematical Operators</a></li>
                </ul>
              </li>
              <li><a class="fold">Sample Data</a>
                <ul class="menu3" >
                  <li><a id="dsdb-sampledata-down" class="" href="/dsdb/sample_data/data_download.html">Sample Data Download</a></li>
                </ul>
              </li>
              <li><a class="fold">Tools</a>
                <ul class="menu3" >
                  <li><a id="dsdb-tools-overview" class="" href="/dsdb/tools/index.html">Tools Overview</a></li>
                  <li><a id="dsdb-tools-shell" class="" href="/dsdb/tools/shell.html">CLI/Shell</a></li>
                  <li><a id="dsdb-tools-webadmin" class="" href="/dsdb/tools/web_admin.html">Web Admin Interface</a></li>
                  <li><a id="dsdb-tools-grafana" class="" href="/dsdb/tools/grafana.html">Grafana Dashboards</a></li>
                  <li><a id="dsdb-tools-telegraf" class="" href="/dsdb/tools/telegraf.html">Telegraf Metrics Collection</a></li>
                  <li><a id="dsdb-tools-chronograf" class="" href="/dsdb/tools/chronograf.html">Chronograf Dashboards</a></li>
                  <li><a id="dsdb-tools-kapacitor" class="" href="/dsdb/tools/kapacitor.html">Kapacitor Monitoring</a></li>
                </ul>
              </li>
              <li><a class="fold">Write Protocols</a>
                <ul class="menu3" >
                  <li><a id="dsdb-writepro-overview" class="" href="/dsdb/write_protocols/index.html">Overview</a></li>
                  <li><a id="dsdb-writepro-line" class="" href="/dsdb/write_protocols/line.html">Line Protocol</a></li>
                  <li><a id="dsdb-writepro-syntax" class="" href="/dsdb/write_protocols/write_syntax.html">Write Syntax</a></li>
                  <li><a id="dsdb-writepro-json" class="" href="/dsdb/write_protocols/json.html">JSON Protocol</a></li>
                  <li><a id="dsdb-writepro-udp" class="" href="/dsdb/write_protocols/udp.html">Service - UDP</a></li>
                  <li><a id="dsdb-writepro-graphite" class="" href="/dsdb/write_protocols/graphite.html">Service - Graphite</a></li>
                  <li><a id="dsdb-writepro-opentsdb" class="" href="/dsdb/write_protocols/opentsdb.html">Servcie - OpenTSDB</a></li>
                  <li><a id="dsdb-writepro-collectd" class="" href="/dsdb/write_protocols/collectd.html">Service - CollectD</a></li>
                </ul>
              </li>
              <li><a class="fold">Troubleshooting</a>
                <ul class="menu3" >
                  <li><a id="dsdb-troubleshoot-overview" class="" href="/dsdb/troubleshooting/index.html">Troubleshooting Overview</a></li>
                  <li><a id="dsdb-troubleshoot-fei" class="" href="/dsdb/troubleshooting/frequently_encountered_issues.html">Frequently Encountered Issues</a></li>
                  <li><a id="dsdb-troubleshoot-monitor" class="" href="/dsdb/troubleshooting/system_monitoring.html">System Monitoring</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><a class="fold">DAC Document</a>
            <ul class="menu2" >
              <li><a id="dac-principal" class="" href="/dac/dac_introduction.html">DAC工作原理</a></li>
              <li><a id="dac-java-api" class="" href="/dac/dac_cloud_api_java.html">DAC Java API</a></li>
              <li><a id="dac-c-api" class="" href="/dac/dac_cloud_api_c.html">DAC C API</a></li>
              <li><a id="dac-cpp-api" class="" href="/dac/dac_cloud_api_cpp.html">DAC C++ API</a></li>
            </ul>
          </li>
          <li><a class="fold">Data Hub</a>
            <ul class="menu2" >
              <li><a class="fold">SDK</a>
                <ul class="menu3" >
                  <li><a id="datahub-sdk-js" class="" href="/data-hub/sdk/javascript.html">JavaScript</a></li>
                  <li><a id="datahub-sdk-embededc" class="" href="/data-hub/sdk/embeded_c.html">Embeded C</a></li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
    </div>

    <div class="side_right">
      <div class="doc">
        <h1 id="query-language-reference">Query Language Reference</h1>
<h2 id="introduction">Introduction</h2>
<p>This is a reference for the DSDB Query Language (&quot;DSDBQL&quot;).
If you're looking for less formal documentation see <a href="/dsdb/query_language/data_exploration.html">Data Exploration</a>, <a href="/dsdb/query_language/schema_exploration.html">Schema Exploration</a>, <a href="/dsdb/query_language/database_management.html">Database Management</a>, and <a href="/dsdb/administration/authentication_and_authorization.html">Authentication and Authorization</a>.</p>
<p>DSDBQL is a SQL-like query language for interacting with DSDB.
It has been lovingly crafted to feel familiar to those coming from other SQL or SQL-like environments while providing features specific to storing and analyzing time series data.</p>
<p>Sections:</p>
<ul>
<li><a href="/dsdb/query_language/spec.html#notation">Notation</a></li>
<li><a href="/dsdb/query_language/spec.html#query-representation">Query representation</a></li>
<li><a href="/dsdb/query_language/spec.html#letters-and-digits">Letters and digits</a></li>
<li><a href="/dsdb/query_language/spec.html#identifiers">Identifiers</a></li>
<li><a href="/dsdb/query_language/spec.html#keywords">Keywords</a></li>
<li><a href="/dsdb/query_language/spec.html#literals">Literals</a></li>
<li><a href="/dsdb/query_language/spec.html#queries">Queries</a></li>
<li><a href="/dsdb/query_language/spec.html#statements">Statements</a></li>
<li><a href="/dsdb/query_language/spec.html#clauses">Clauses</a></li>
<li><a href="/dsdb/query_language/spec.html#expressions">Expressions</a></li>
<li><a href="/dsdb/query_language/spec.html#other">Other</a></li>
</ul>
<h2 id="notation">Notation</h2>
<p>The syntax is specified using Extended Backus-Naur Form (&quot;EBNF&quot;).
EBNF is the same notation used in the <a href="http://golang.org">Go</a> programming language specification, which can be found <a href="https://golang.org/ref/spec">here</a>.
Not so coincidentally, DSDB is written in Go.</p>
<pre><code>Production  = production_name "=" [ Expression ] "." .
Expression  = Alternative { "|" Alternative } .
Alternative = Term { Term } .
Term        = production_name | token [ "…" token ] | Group | Option | Repetition .
Group       = "(" Expression ")" .
Option      = "[" Expression "]" .
Repetition  = "{" Expression "}" .</code></pre>
<p>Notation operators in order of increasing precedence:</p>
<pre><code>|   alternation
()  grouping
[]  option (0 or 1 times)
{}  repetition (0 to n times)</code></pre>
<h2 id="query-representation">Query representation</h2>
<h3 id="characters">Characters</h3>
<p>DSDBQL is Unicode text encoded in <a href="http://en.wikipedia.org/wiki/UTF-8">UTF-8</a>.</p>
<pre><code>newline             = /* the Unicode code point U+000A */ .
unicode_char        = /* an arbitrary Unicode code point except newline */ .</code></pre>
<h2 id="letters-and-digits">Letters and digits</h2>
<p>Letters are the set of ASCII characters plus the underscore character _ (U+005F) is considered a letter.</p>
<p>Only decimal digits are supported.</p>
<pre><code>letter              = ascii_letter | "_" .
ascii_letter        = "A" … "Z" | "a" … "z" .
digit               = "0" … "9" .</code></pre>
<h2 id="identifiers">Identifiers</h2>
<p>Identifiers are tokens which refer to <a href="/dsdb/concepts/glossary.html#database">database</a> names, <a href="/dsdb/concepts/glossary.html#retention-policy-rp">retention policy</a> names, <a href="/dsdb/concepts/glossary.html#user">user</a> names, <a href="/dsdb/concepts/glossary.html#measurement">measurement</a> names, <a href="/dsdb/concepts/glossary.html#tag-key">tag keys</a>, and <a href="/dsdb/concepts/glossary.html#field-key">field keys</a>.</p>
<p>The rules:</p>
<ul>
<li>double quoted identifiers can contain any unicode character other than a new line</li>
<li>double quoted identifiers can contain escaped <code>"</code> characters (i.e., <code>\"</code>)</li>
<li>unquoted identifiers must start with an upper or lowercase ASCII character or &quot;_&quot;</li>
<li>unquoted identifiers may contain only ASCII letters, decimal digits, and &quot;_&quot;</li>
</ul>
<pre><code>identifier          = unquoted_identifier | quoted_identifier .
unquoted_identifier = ( letter ) { letter | digit } .
quoted_identifier   = `"` unicode_char { unicode_char } `"` .</code></pre>
<h4 id="examples">Examples:</h4>
<pre><code>cpu
_cpu_stats
"1h"
"anything really"
"1_Crazy-1337.identifier&gt;NAME👍"</code></pre>
<h2 id="keywords">Keywords</h2>
<pre><code>ALL           ALTER         ANY           AS            ASC           BEGIN
BY            CREATE        CONTINUOUS    DATABASE      DATABASES     DEFAULT
DELETE        DESC          DESTINATIONS  DIAGNOSTICS   DISTINCT      DROP
DURATION      END           EVERY         EXISTS        EXPLAIN       FIELD
FOR           FORCE         FROM          GRANT         GRANTS        GROUP
GROUPS        IF            IN            INF           INNER         INSERT
INTO          KEY           KEYS          LIMIT         SHOW          MEASUREMENT
MEASUREMENTS  NOT           OFFSET        ON            ORDER         PASSWORD
POLICY        POLICIES      PRIVILEGES    QUERIES       QUERY         READ
REPLICATION   RESAMPLE      RETENTION     REVOKE        SELECT        SERIES
SERVER        SERVERS       SET           SHARD         SHARDS        SLIMIT
SOFFSET       STATS         SUBSCRIPTION  SUBSCRIPTIONS TAG           TO
USER          USERS         VALUES        WHERE         WITH          WRITE</code></pre>
<h2 id="literals">Literals</h2>
<h3 id="integers">Integers</h3>
<p>DSDBQL supports decimal integer literals.
Hexadecimal and octal literals are not currently supported.</p>
<pre><code>int_lit             = ( "1" … "9" ) { digit } .</code></pre>
<h3 id="floats">Floats</h3>
<p>DSDBQL supports floating-point literals.
Exponents are not currently supported.</p>
<pre><code>float_lit           = int_lit "." int_lit .</code></pre>
<h3 id="strings">Strings</h3>
<p>String literals must be surrounded by single quotes.
Strings may contain <code>'</code> characters as long as they are escaped (i.e., <code>\'</code>).</p>
<pre><code>string_lit          = `'` { unicode_char } `'`' .</code></pre>
<h3 id="durations">Durations</h3>
<p>Duration literals specify a length of time.
An integer literal followed immediately (with no spaces) by a duration unit listed below is interpreted as a duration literal.</p>
<h4 id="duration-units">Duration units</h4>
<table>
<thead>
<tr>
<th style="text-align: left;">Units</th>
<th style="text-align: left;">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">u or µ</td>
<td style="text-align: left;">microseconds (1 millionth of a second)</td>
</tr>
<tr>
<td style="text-align: left;">ms</td>
<td style="text-align: left;">milliseconds (1 thousandth of a second)</td>
</tr>
<tr>
<td style="text-align: left;">s</td>
<td style="text-align: left;">second</td>
</tr>
<tr>
<td style="text-align: left;">m</td>
<td style="text-align: left;">minute</td>
</tr>
<tr>
<td style="text-align: left;">h</td>
<td style="text-align: left;">hour</td>
</tr>
<tr>
<td style="text-align: left;">d</td>
<td style="text-align: left;">day</td>
</tr>
<tr>
<td style="text-align: left;">w</td>
<td style="text-align: left;">week</td>
</tr>
</tbody>
</table>
<pre><code>duration_lit        = int_lit duration_unit .
duration_unit       = "u" | "µ" | "s" | "h" | "d" | "w" | "ms" .</code></pre>
<h3 id="dates-amp-times">Dates &amp; Times</h3>
<p>The date and time literal format is not specified in EBNF like the rest of this document.
It is specified using Go's date / time parsing format, which is a reference date written in the format required by DSDBQL.
The reference date time is:</p>
<p>DSDBQL reference date time: January 2nd, 2006 at 3:04:05 PM</p>
<pre><code>time_lit            = "2006-01-02 15:04:05.999999" | "2006-01-02"</code></pre>
<h3 id="booleans">Booleans</h3>
<pre><code>bool_lit            = TRUE | FALSE .</code></pre>
<h3 id="regular-expressions">Regular Expressions</h3>
<pre><code>regex_lit           = "/" { unicode_char } "/" .</code></pre>
<p><strong>Comparators:</strong><br />
<code>=~</code> matches against<br />
<code>!=</code> doesn't match against</p>
<blockquote>
<p><strong>Note:</strong> Use regular expressions to match measurements and tags.
You cannot use regular expressions to match databases, retention policies, or fields.</p>
</blockquote>
<h2 id="queries">Queries</h2>
<p>A query is composed of one or more statements separated by a semicolon.</p>
<pre><code>query               = statement { ; statement } .

statement           = alter_retention_policy_stmt |
                      create_continuous_query_stmt |
                      create_database_stmt |
                      create_retention_policy_stmt |
                      create_subscription_stmt |
                      create_user_stmt |
                      delete_stmt |
                      drop_continuous_query_stmt |
                      drop_database_stmt |
                      drop_measurement_stmt |
                      drop_retention_policy_stmt |
                      drop_series_stmt |
                      drop_subscription_stmt |
                      drop_user_stmt |
                      grant_stmt |
                      show_continuous_queries_stmt |
                      show_databases_stmt |
                      show_field_keys_stmt |
                      show_grants_stmt |
                      show_measurements_stmt |
                      show_retention_policies |
                      show_series_stmt |
                      show_shard_groups_stmt |
                      show_shards_stmt |
                      show_subscriptions_stmt|
                      show_tag_keys_stmt |
                      show_tag_values_stmt |
                      show_users_stmt |
                      revoke_stmt |
                      select_stmt .</code></pre>
<h2 id="statements">Statements</h2>
<h3 id="alter-retention-policy">ALTER RETENTION POLICY</h3>
<pre><code>alter_retention_policy_stmt  = "ALTER RETENTION POLICY" policy_name on_clause
                               retention_policy_option
                               [ retention_policy_option ]
                               [ retention_policy_option ] .</code></pre>
<h4 id="examples-1">Examples:</h4>
<pre><code class="language-sql">-- Set default retention policy for mydb to 1h.cpu.
ALTER RETENTION POLICY "1h.cpu" ON mydb DEFAULT

-- Change duration and replication factor.
ALTER RETENTION POLICY policy1 ON somedb DURATION 1h REPLICATION 4</code></pre>
<h3 id="create-continuous-query">CREATE CONTINUOUS QUERY</h3>
<pre><code>create_continuous_query_stmt = "CREATE CONTINUOUS QUERY" query_name on_clause
                               [ "RESAMPLE" resample_opts ]
                               "BEGIN" select_stmt "END" .

query_name                   = identifier .

resample_opts                = (every_stmt for_stmt | every_stmt | for_stmt) .
every_stmt                   = "EVERY" duration_lit
for_stmt                     = "FOR" duration_lit</code></pre>
<h4 id="examples-2">Examples:</h4>
<pre><code class="language-sql">-- selects from default retention policy and writes into 6_months retention policy
CREATE CONTINUOUS QUERY "10m_event_count"
ON db_name
BEGIN
  SELECT count(value)
  INTO "6_months".events
  FROM events
  GROUP BY time(10m)
END;

-- this selects from the output of one continuous query in one retention policy and outputs to another series in another retention policy
CREATE CONTINUOUS QUERY "1h_event_count"
ON db_name
BEGIN
  SELECT sum(count) as count
  INTO "2_years".events
  FROM "6_months".events
  GROUP BY time(1h)
END;

-- this customizes the resample interval so the interval is queried every 10s and intervals are resampled until 2m after their start time
-- when resample is used, at least one of "EVERY" or "FOR" must be used
CREATE CONTINUOUS QUERY "cpu_mean"
ON db_name
RESAMPLE EVERY 10s FOR 2m
BEGIN
  SELECT mean(value)
  INTO "cpu_mean"
  FROM "cpu"
  GROUP BY time(1m)
END;</code></pre>
<h3 id="create-database">CREATE DATABASE</h3>
<pre><code>create_database_stmt = "CREATE DATABASE" ["IF NOT EXISTS"] db_name</code></pre>
<h4 id="examples-3">Examples:</h4>
<pre><code class="language-sql">CREATE DATABASE foo

-- create a database if it doesn't already exist
CREATE DATABASE IF NOT EXISTS foo</code></pre>
<h3 id="create-retention-policy">CREATE RETENTION POLICY</h3>
<pre><code>create_retention_policy_stmt = "CREATE RETENTION POLICY" policy_name on_clause
                               retention_policy_duration
                               retention_policy_replication
                               [ "DEFAULT" ] .</code></pre>
<h4 id="examples-4">Examples</h4>
<pre><code class="language-sql">-- Create a retention policy.
CREATE RETENTION POLICY "10m.events" ON somedb DURATION 10m REPLICATION 2

-- Create a retention policy and set it as the default.
CREATE RETENTION POLICY "10m.events" ON somedb DURATION 10m REPLICATION 2 DEFAULT</code></pre>
<h3 id="create-subscription">CREATE SUBSCRIPTION</h3>
<p>Subscriptions tell DSDB to send all the data it receives to <a href="https://docs.influxdata.com/kapacitor/introduction.html">Kapacitor</a>.</p>
<pre><code>create_subscription_stmt = "CREATE SUBSCRIPTION" subscription_name "ON" db_name "." retention_policy "DESTINATIONS" ("ANY"|"ALL") host { "," host} .</code></pre>
<h4 id="examples-5">Examples:</h4>
<pre><code class="language-sql">-- Create a SUBSCRIPTION on database 'mydb' and retention policy 'default' that send data to 'example.com:9090' via UDP.
CREATE SUBSCRIPTION sub0 ON "mydb"."default" DESTINATIONS ALL 'udp://example.com:9090'

-- Create a SUBSCRIPTION on database 'mydb' and retention policy 'default' that round robins the data to 'h1.example.com:9090' and 'h2.example.com:9090'.
CREATE SUBSCRIPTION sub0 ON "mydb"."default" DESTINATIONS ANY 'udp://h1.example.com:9090', 'udp://h2.example.com:9090'</code></pre>
<h3 id="create-user">CREATE USER</h3>
<pre><code>create_user_stmt = "CREATE USER" user_name "WITH PASSWORD" password
                   [ "WITH ALL PRIVILEGES" ] .</code></pre>
<h4 id="examples-6">Examples:</h4>
<pre><code class="language-sql">-- Create a normal database user.
CREATE USER jdoe WITH PASSWORD '1337password'

-- Create a cluster admin.
-- Note: Unlike the GRANT statement, the "PRIVILEGES" keyword is required here.
CREATE USER jdoe WITH PASSWORD '1337password' WITH ALL PRIVILEGES</code></pre>
<blockquote>
<p><strong>Note:</strong> The password string must be wrapped in single quotes.</p>
</blockquote>
<h3 id="drop-continuous-query">DROP CONTINUOUS QUERY</h3>
<pre><code>drop_continuous_query_stmt = "DROP CONTINUOUS QUERY" query_name "ON" db_name.</code></pre>
<h4 id="example">Example:</h4>
<pre><code class="language-sql">DROP CONTINUOUS QUERY myquery ON mydb</code></pre>
<h3 id="drop-database">DROP DATABASE</h3>
<pre><code>drop_database_stmt = "DROP DATABASE" ["IF EXISTS"] db_name .</code></pre>
<h4 id="example-1">Example:</h4>
<pre><code class="language-sql">DROP DATABASE mydb

-- drop a database only if it exists
DROP DATABASE IF EXISTS mydb</code></pre>
<h3 id="drop-measurement">DROP MEASUREMENT</h3>
<pre><code>drop_measurement_stmt = "DROP MEASUREMENT" measurement .</code></pre>
<h4 id="examples-7">Examples:</h4>
<pre><code class="language-sql">-- drop the cpu measurement
DROP MEASUREMENT cpu</code></pre>
<h3 id="drop-retention-policy">DROP RETENTION POLICY</h3>
<pre><code>drop_retention_policy_stmt = "DROP RETENTION POLICY" policy_name on_clause .</code></pre>
<h4 id="example-2">Example:</h4>
<pre><code class="language-sql">-- drop the retention policy named 1h.cpu from mydb
DROP RETENTION POLICY "1h.cpu" ON mydb</code></pre>
<h3 id="drop-series">DROP SERIES</h3>
<pre><code>drop_series_stmt = "DROP SERIES" ( from_clause | where_clause | from_clause where_clause ) .</code></pre>
<h4 id="example-3">Example:</h4>
<pre><code class="language-sql"></code></pre>
<h3 id="drop-subscription">DROP SUBSCRIPTION</h3>
<pre><code>drop_subscription_stmt = "DROP SUBSCRIPTION" subscription_name "ON" db_name "." retention_policy .</code></pre>
<h4 id="example-4">Example:</h4>
<pre><code class="language-sql">DROP SUBSCRIPTION sub0 ON "mydb"."default"</code></pre>
<h3 id="drop-user">DROP USER</h3>
<pre><code>drop_user_stmt = "DROP USER" user_name .</code></pre>
<h4 id="example-5">Example:</h4>
<pre><code class="language-sql">DROP USER jdoe</code></pre>
<h3 id="grant">GRANT</h3>
<blockquote>
<p><strong>NOTE:</strong> Users can be granted privileges on databases that do not exist.</p>
</blockquote>
<pre><code>grant_stmt = "GRANT" privilege [ on_clause ] to_clause</code></pre>
<h4 id="examples-8">Examples:</h4>
<pre><code class="language-sql">-- grant cluster admin privileges
GRANT ALL TO jdoe

-- grant read access to a database
GRANT READ ON mydb TO jdoe</code></pre>
<h3 id="show-continuous-queries">SHOW CONTINUOUS QUERIES</h3>
<pre><code>show_continuous_queries_stmt = "SHOW CONTINUOUS QUERIES" .</code></pre>
<h4 id="example-6">Example:</h4>
<pre><code class="language-sql">-- show all continuous queries
SHOW CONTINUOUS QUERIES</code></pre>
<h3 id="show-databases">SHOW DATABASES</h3>
<pre><code>show_databases_stmt = "SHOW DATABASES" .</code></pre>
<h4 id="example-7">Example:</h4>
<pre><code class="language-sql">-- show all databases
SHOW DATABASES</code></pre>
<h3 id="show-field-keys">SHOW FIELD KEYS</h3>
<pre><code>show_field_keys_stmt = "SHOW FIELD KEYS" [ from_clause ] .</code></pre>
<h4 id="examples-9">Examples:</h4>
<pre><code class="language-sql">-- show field keys from all measurements
SHOW FIELD KEYS

-- show field keys from specified measurement
SHOW FIELD KEYS FROM cpu</code></pre>
<h3 id="show-grants">SHOW GRANTS</h3>
<pre><code>show_grants_stmt = "SHOW GRANTS FOR" user_name .</code></pre>
<h4 id="example-8">Example:</h4>
<pre><code class="language-sql">-- show grants for jdoe
SHOW GRANTS FOR jdoe</code></pre>
<h3 id="show-measurements">SHOW MEASUREMENTS</h3>
<pre><code>show_measurements_stmt = "SHOW MEASUREMENTS" [ with_measurement_clause ] [ where_clause ] [ limit_clause ] [ offset_clause ] .</code></pre>
<pre><code class="language-sql">-- show all measurements
SHOW MEASUREMENTS

-- show measurements where region tag = 'uswest' AND host tag = 'serverA'
SHOW MEASUREMENTS WHERE region = 'uswest' AND host = 'serverA'

-- show measurements that start with 'h2o'
SHOW MEASUREMENTS WITH MEASUREMENT =~ /h2o.*/</code></pre>
<h3 id="show-retention-policies">SHOW RETENTION POLICIES</h3>
<pre><code>show_retention_policies = "SHOW RETENTION POLICIES" on_clause .</code></pre>
<h4 id="example-9">Example:</h4>
<pre><code class="language-sql">-- show all retention policies on a database
SHOW RETENTION POLICIES ON mydb</code></pre>
<h3 id="show-series">SHOW SERIES</h3>
<pre><code>show_series_stmt = "SHOW SERIES" [ from_clause ] [ where_clause ] [ limit_clause ] [ offset_clause ] .</code></pre>
<h4 id="example-10">Example:</h4>
<pre><code class="language-sql"></code></pre>
<h3 id="show-shard-groups">SHOW SHARD GROUPS</h3>
<pre><code>show_shard_groups_stmt = "SHOW SHARD GROUPS" .</code></pre>
<h4 id="example-11">Example:</h4>
<pre><code class="language-sql">SHOW SHARD GROUPS</code></pre>
<h3 id="show-shards">SHOW SHARDS</h3>
<pre><code>show_shards_stmt = "SHOW SHARDS" .</code></pre>
<h4 id="example-12">Example:</h4>
<pre><code class="language-sql">SHOW SHARDS</code></pre>
<h3 id="show-subscriptions">SHOW SUBSCRIPTIONS</h3>
<pre><code>show_subscriptions_stmt = "SHOW SUBSCRIPTIONS" .</code></pre>
<h4 id="example-13">Example:</h4>
<pre><code class="language-sql">SHOW SUBSCRIPTIONS</code></pre>
<h3 id="show-tag-keys">SHOW TAG KEYS</h3>
<pre><code>show_tag_keys_stmt = "SHOW TAG KEYS" [ from_clause ] [ where_clause ] [ group_by_clause ]
                     [ limit_clause ] [ offset_clause ] .</code></pre>
<h4 id="examples-10">Examples:</h4>
<pre><code class="language-sql">-- show all tag keys
SHOW TAG KEYS

-- show all tag keys from the cpu measurement
SHOW TAG KEYS FROM cpu

-- show all tag keys from the cpu measurement where the region key = 'uswest'
SHOW TAG KEYS FROM cpu WHERE region = 'uswest'

-- show all tag keys where the host key = 'serverA'
SHOW TAG KEYS WHERE host = 'serverA'</code></pre>
<h3 id="show-tag-values">SHOW TAG VALUES</h3>
<pre><code>show_tag_values_stmt = "SHOW TAG VALUES" [ from_clause ] with_tag_clause [ where_clause ]
                       [ group_by_clause ] [ limit_clause ] [ offset_clause ] .</code></pre>
<h4 id="examples-11">Examples:</h4>
<pre><code class="language-sql">-- show all tag values across all measurements for the region tag
SHOW TAG VALUES WITH KEY = 'region'

-- show tag values from the cpu measurement for the region tag
SHOW TAG VALUES FROM cpu WITH KEY = 'region'

-- show tag values from the cpu measurement for region &amp; host tag keys where service = 'redis'
SHOW TAG VALUES FROM cpu WITH KEY IN (region, host) WHERE service = 'redis'</code></pre>
<h3 id="show-users">SHOW USERS</h3>
<pre><code>show_users_stmt = "SHOW USERS" .</code></pre>
<h4 id="example-14">Example:</h4>
<pre><code class="language-sql">-- show all users
SHOW USERS</code></pre>
<h3 id="revoke">REVOKE</h3>
<pre><code>revoke_stmt = "REVOKE" privilege [ on_clause ] "FROM" user_name .</code></pre>
<h4 id="examples-12">Examples:</h4>
<pre><code class="language-sql">-- revoke cluster admin from jdoe
REVOKE ALL PRIVILEGES FROM jdoe

-- revoke read privileges from jdoe on mydb
REVOKE READ ON mydb FROM jdoe</code></pre>
<h3 id="select">SELECT</h3>
<pre><code>select_stmt = "SELECT" fields from_clause [ into_clause ] [ where_clause ]
              [ group_by_clause ] [ order_by_clause ] [ limit_clause ]
              [ offset_clause ] [ slimit_clause ] [ soffset_clause ] .</code></pre>
<h4 id="examples-13">Examples:</h4>
<pre><code class="language-sql">-- select mean value from the cpu measurement where region = 'uswest' grouped by 10 minute intervals
SELECT mean(value) FROM cpu WHERE region = 'uswest' GROUP BY time(10m) fill(0)

-- select from all measurements beginning with cpu into the same measurement name in the cpu_1h retention policy
SELECT mean(value) INTO cpu_1h.:MEASUREMENT FROM /cpu.*/</code></pre>
<h2 id="clauses">Clauses</h2>
<pre><code>from_clause     = "FROM" measurements .

group_by_clause = "GROUP BY" dimensions fill(fill_option).

into_clause     = "INTO" ( measurement | back_ref ).

limit_clause    = "LIMIT" int_lit .

offset_clause   = "OFFSET" int_lit .

slimit_clause   = "SLIMIT" int_lit .

soffset_clause  = "SOFFSET" int_lit .

on_clause       = "ON" db_name .

order_by_clause = "ORDER BY" sort_fields .

to_clause       = "TO" user_name .

where_clause    = "WHERE" expr .

with_measurement_clause = "WITH MEASUREMENT" ( "=" measurement | "=~" regex_lit ) .

with_tag_clause = "WITH KEY" ( "=" tag_key | "IN (" tag_keys ")" ) .</code></pre>
<h2 id="expressions">Expressions</h2>
<pre><code>binary_op        = "+" | "-" | "*" | "/" | "AND" | "OR" | "=" | "!=" | "&lt;" |
                   "&lt;=" | "&gt;" | "&gt;=" .

expr             = unary_expr { binary_op unary_expr } .

unary_expr       = "(" expr ")" | var_ref | time_lit | string_lit | int_lit |
                   float_lit | bool_lit | duration_lit | regex_lit .</code></pre>
<h2 id="other">Other</h2>
<pre><code>alias            = "AS" identifier .

back_ref         = ( policy_name ".:MEASUREMENT" ) |
                   ( db_name "." [ policy_name ] ".:MEASUREMENT" ) .

db_name          = identifier .

dimension        = expr .

dimensions       = dimension { "," dimension } .

field_key        = identifier .

field            = expr [ alias ] .

fields           = field { "," field } .

fill_option      = "null" | "none" | "previous" | int_lit | float_lit .

host             = string_lit .

measurement      = measurement_name |
                   ( policy_name "." measurement_name ) |
                   ( db_name "." [ policy_name ] "." measurement_name ) .

measurements     = measurement { "," measurement } .

measurement_name = identifier .

password         = string_lit .

policy_name      = identifier .

privilege        = "ALL" [ "PRIVILEGES" ] | "READ" | "WRITE" .

query_name       = identifier .

retention_policy = identifier .

retention_policy_option      = retention_policy_duration |
                               retention_policy_replication |
                               "DEFAULT" .

retention_policy_duration    = "DURATION" duration_lit .
retention_policy_replication = "REPLICATION" int_lit

series_id        = int_lit .

sort_field       = field_key [ ASC | DESC ] .

sort_fields      = sort_field { "," sort_field } .

subscription_name = identifier .

tag_key          = identifier .

tag_keys         = tag_key { "," tag_key } .

user_name        = identifier .

var_ref          = measurement .</code></pre>
      </div>

              <div class="tract"><img src="/images/tract.png"/></div>
            <div class="clearfix"></div>
      <div class="scroll" id="scroll" style="display:none;">
			     <img src="/images/top.png"/>
		  </div>
    </div>
  </div>
  <script>hljs.initHighlightingOnLoad();</script>
</body>

</html>
