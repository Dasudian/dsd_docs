<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="大数点物联网开发者平台文档，基于大数点物联网平台，帮助开发者快速构建物联网应用">
  <meta name="author" content="Dasudian Gruop">
  <title>大数点文档中心</title>
  <link href='http://fonts.useso.com/css?family=Open+Sans:300|Source+Code+Pro:400' rel='stylesheet' type='text/css'>
  <!-- <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css"> -->
  <link href="http://docs.dasudian.com/css/theme.min.css" rel="stylesheet">
  <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
  <div id="header" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <a href="http://docs.dasudian.com" class="navbar-brand">大数点文档中心</a>
        <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      
            <div class="navbar-collapse collapse" id="navbar-main">
        <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://solution.dasudian.com">解决方案</a></li>
                    <li><a href="http://docs.dasudian.com">文档</a></li>
                    <li><a href="http://price.dasudian.com">定价</a></li>
                    <li><a href="http://community.dasudian.com">社区</a></li>
                  </ul>
      </div>
            
    </div>
  </div>

  <div id="wrapper">
    <!-- Sidebar -->
        <div id="sidebar-wrapper">
      <ul class="sidebar-nav">
                <li>
          <a class="section" href="#sidebar-wrapper"><i class="fa fa-caret-right"></i>介绍</a>
          <ul>
                        <li class="">
              <a href="http://docs.dasudian.com/docs/get-started/intro-dsd.html">大数点介绍</a>
            </li>
                      </ul>
        </li>
                <li>
          <a class="section" href="#sidebar-wrapper"><i class="fa fa-caret-right"></i>开发者平台操作指南</a>
          <ul>
                        <li class="">
              <a href="http://docs.dasudian.com/docs/dev-platform/register-login.html">注册和登陆</a>
            </li>
                      </ul>
        </li>
                <li>
          <a class="section" href="#sidebar-wrapper"><i class="fa fa-caret-right"></i>服务集成指南</a>
          <ul>
                        <li class="active">
              <a href="http://docs.dasudian.com/docs/integration-dev/integrate-im-android.html">Android上集成IM功能</a>
            </li>
                        <li class="">
              <a href="http://docs.dasudian.com/docs/integration-dev/integrate-im-ios.html">iOS上集成IM功能</a>
            </li>
                      </ul>
        </li>
              </ul>
    </div>
        <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">
      <div class="container">
        <div class="row">
          <div id="content" class="col-sm-offset-3 col-lg-offset-2 col-sm-9 col-lg-10">
            <h1 id="androidim">Android上集成IM功能</h1>
<h2 id="">集成前准备</h2>
<p>到<a href="https://dev.dasudian.com/">大数点开发者平台</a>注册成为大数点合作伙伴并创建应用。  </p>
<h2 id="sdk">下载SDK</h2>
<p>到<a href="http://doc.dasudian.com/api/sdk">大数点官网</a>下载IM SDK　。  </p>
<h2 id="sdk-1">SDK内容</h2>
<ul>
<li>dsd-lib-IM-v1.jar</li>
<li>libdsd_im.so</li>
</ul>
<h2 id="-1">配置工程</h2>
<h3 id="jar">导入库和jar包</h3>
<p>拷贝libdsd_im.so到libs/armeabi目录下，如果没有armeabi目录，请手动创建该目录。
拷贝dsd-lib-IM-v1到libs目录下，如下图所示。<br />
<img src="images/andorid_im-1.png" alt="导入.so到工程目录下" /></p>
<h3 id="-2">配置权限</h3>
<p>如下图所示,在AndroidManifest.xml中加入如下内容使能必要的访问权限。  </p>
<pre><code class="language-xml">&lt;!-- 访问网络权限 --&gt;
&lt;uses-permission android:name="android.permission.INTERNET"&gt;&lt;/uses-permission&gt;
&lt;!-- 获取mac地址权限 --&gt;
&lt;uses-permission android:name="android.permission.CHANGE_NETWORK_STATE" /&gt;
&lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" /&gt;
&lt;uses-permission android:name="android.permission.CHANGE_WIFI_STATE" /&gt;
&lt;uses-permission android:name="android.permission.ACCESS_WIFI_STATE" /&gt;</code></pre>
<h2 id="sdk-2">初始化SDK</h2>
<h3 id="-3">实现如下接口</h3>
<pre><code class="language-java">public class MainActivity extends Activity implements DsdClientInterface</code></pre>
<pre><code class="language-java">@Override
public void docallback(int event, String content, int len)</code></pre>
<ul>
<li>
<p>注意：不要在该函数中刷新UI。</p>
</li>
<li>
<p>接口函数实现,该接口函数是SDK的核心函数,该函数会在下面几种情况被调用.</p>
<p>1.用户发送的异步消息成功</p>
<p>2.收到服务器发来的单播,组播,广播消息</p>
<p>3.连接服务器成功</p>
<p>4.该用户被提出某个组播组</p>
<p>5.与服务器连接断开</p>
</li>
<li>
<p>参数说明</p>
<table>
<thead>
<tr>
<th>event</th>
<th>content</th>
<th>len</th>
</tr>
</thead>
<tbody>
<tr>
<td>1:异步发送消息成功</td>
<td>发送该消息时得消息id</td>
<td>消息id长度</td>
</tr>
<tr>
<td>2:收到单播消息</td>
<td>{&quot;msg&quot;:&quot;消息内容&quot;,&quot;from&quot;:&quot;发送消息者&quot;,&quot;time&quot;:&quot;发送消息的时间&quot;}</td>
<td>JSON长度</td>
</tr>
<tr>
<td>3:收到组播消息</td>
<td>{&quot;msg&quot;:&quot;消息内容&quot;,&quot;from&quot;:&quot;发送消息者&quot;,&quot;time&quot;:&quot;发送消息的时间&quot;,&quot;groupid&quot;:&quot;组id&quot;}</td>
<td>JSON长度</td>
</tr>
<tr>
<td>4:收到广播消息</td>
<td>{&quot;msg&quot;:&quot;消息内容&quot;,&quot;from&quot;:&quot;发送消息者&quot;,&quot;time&quot;:&quot;发送消息的时间&quot;}</td>
<td>JSON长度</td>
</tr>
<tr>
<td>5:连接服务器成功</td>
<td>NULL</td>
<td>0</td>
</tr>
<tr>
<td>6:用户被踢出组播组</td>
<td>NULL</td>
<td>0</td>
</tr>
<tr>
<td>7:与服务器链接断开</td>
<td>NULL</td>
<td>0</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h3 id="-4">链接服务器</h3>
<pre><code class="language-java">// 获取sdk实例
private DsdImClientJNI dsdClientTest = DsdImClientJNI.getInstance();</code></pre>
<pre><code class="language-java">// 注册回调函数到SDK中,将callback函数注册到SDK中,SDK会在事件发生的时候回调该函数.
// 其中this为实现了docallback()回调函数的类
dsdClientTest.setCallfuc(this);</code></pre>
<pre><code class="language-java">/**
 * 初始化sdk并链接服务器。
 * @param  serverAddress  服务器地址，为空则默认使用大数点提供得服务器
 * @param  version      "1.0"
 * @param  appID        app的id
 * @param  appSpec      app得描述信息
 * @param  userID       用户名
 * @param  opt          可选得用户信息，用于后台统计；为空或是一个用户信息的JSON
 * @param  clientID     客户端id(手机mac地址），用于服务器向客户端推送消息
 * @param  obj          DsdImClientJNI得实例对象
 * @return              成功:0,失败:-1
 */
int dsdInit(String serverAddress, String version, String appID, String appSpec, String userID, String opt, String clientID, DsdImClientJNI obj);</code></pre>
<h2 id="-5">发送单播消息</h2>
<p>注意：所有发送消息相关的函数，消息都必须以如下JSON格式发送。  </p>
<pre><code>{"t":"0|1|2","b":"msg content"}
@t： 消息类型
    0 文本
    1 语音
    2 视频
@b： 消息内容</code></pre>
<p>同步发送  </p>
<pre><code class="language-java">/**
 * 同步单播消息.该函数会阻塞到收到服务器得ack或者超时后返回.
 * @param  from       发送消息得人
 * @param  toUserlist 目标用户列表
 * @param  users      目标用户个数
 * @param  msg        消息内容,必须为JSON格式
 * @return            成功:0,失败:-1
 */
int dsdSyncSendWithAck(String from, String[] toUserList, int users, String msg);</code></pre>
<p>异步发送  </p>
<pre><code class="language-java">/**
 * 异步发送单播消息,该函数不会阻塞调用者.
 * @param from       发送者
 * @param toUserlist 目标用户列表
 * @param users      目标用户个数
 * @param msg        消息内容,必须为JSON格式
 * @param msgid      用户指定得msgid,如果发送成功,该msgid会在接口函数中上报.
 */
void dsdAsyncSendWithAck(String from, String[] toUserList, int users, String msg, String msgid);</code></pre>
<h2 id="-6">发送组播消息</h2>
<p>同步发送  </p>
<pre><code class="language-java">/**
 * 同步得发送组播消息,该函数会阻塞到收到服务器得ack或者超时后返回.
 * @param  user    发送者
 * @param  groupid 组id
 * @param  msg     消息内容
 * @return         成功:0,失败:-1
 */
int dsdSyncMulticastwithAck(String user, String groupid, String msg);</code></pre>
<p>异步发送  </p>
<pre><code class="language-java">/**
 * 异步得发送组播消息,该函数不会阻塞调用者.
 * @param user    发送者
 * @param groupid 组id
 * @param msg     消息内容
 * @param msgid   用户指定得msgid,如果发送成功,该msgid会在回调函数中上报.
 */
void dsdAsyncMulticastwithAck(String user, String groupid, String msg, String msgid);</code></pre>
<h2 id="-7">发送广播消息</h2>
<p>同步广播  </p>
<pre><code class="language-java">/**
 * 同步得发送广播消息,该函数会阻塞到收到服务器得ack或者超时后返回.
 * @param  user 发送者
 * @param  msg  消息内容
 * @return      成功:0,失败:-1
 */
int dsdSyncBroadcastWithAck(String user, String msg);</code></pre>
<p>异步广播  </p>
<pre><code class="language-java">/**
 * 异步得发送广播消息,该函数不会阻塞调用者.
 * @param user  发送者
 * @param msg   消息内容
 * @param msgid 用户指定得msgid,如果发送成功,该msgid会在回调函数中上报.
 */
void dsdAsyncBroadcastWithAck(String user, String msg, String msgid);</code></pre>
<h2 id="-8">创建组</h2>
<pre><code class="language-java">/**
 * 创建组播组,该函数会阻塞到收到服务器得ack或者超时后返回.
 * @param  user      用户名
 * @param  groupName 组名
 * @return           成功:返回组播组得id,失败:NULL
 */
String dsdCreateGroup(String user, String groupName);</code></pre>
<h2 id="-9">加入组</h2>
<pre><code class="language-java">/**
 * 加入组播组,该函数会阻塞到收到服务器得ack或者超时后返回.
 * @param  user    用户名
 * @param  groupid dsdCreateGroup函数返回得组播组id
 * @return         成功:0,失败-1
 */
int dsdJoinGroup(String user, String groupid);</code></pre>
<h2 id="-10">离开组</h2>
<pre><code class="language-java">/**
 * 离开组播组,该函数会阻塞到收到服务器得ack或者超时后返回.
 * @param  user    离开得用户
 * @param  groupid dsdCreateGroup函数返回得组播组id
 * @return         成功:0,失败:-1
 */
int dsdLeaveGroup(String user, String groupid);</code></pre>
<h2 id="-11">将某人踢出组</h2>
<pre><code class="language-java">/**
 * 将某人踢出组播组,该函数会阻塞到收到服务器得ack或者超时后返回.
 * @param  user        组播组拥有者
 * @param  groupid     dsdCreateGroup函数返回得组播组id
 * @param  groupmember 要踢出得人
 * @return             成功:0,失败-1
 */
int dsdKickOutGroup(String user, String groupid, String groupMember);</code></pre>
<h2 id="-12">与服务器断开链接</h2>
<pre><code class="language-java">/**
 * 退出登陆，调用该函数后将不会收到服务器得推送消息。
 */
void dsdDisConnect();</code></pre>
<h2 id="android">下载Android示例程序</h2>
<p><a href="https://www.github.com/Dasudian/imsdk-example-android">下载Android示例程序</a></p>
          </div>
        </div>
      </div>
    </div>
    <!-- /#page-content-wrapper -->

        
        <a href="#" id="menu-toggle" title="Toggle Menu"><i class="fa fa-bars"></i></a>
    
  </div>
  <!-- /#wrapper -->

  <footer class="footer hidden-xs hidden-sm">
    <!-- Made by hands by
    <a href="http://gm.zoomlab.it/" title="Giuseppe Mazzapica Home Page" target="_blank">Giuseppe Mazzapica</a>, with
    <a href="http://couscous.io/" title="Couscous" target="_blank">Couscous</a>,
    <a href="http://getbootstrap.com/" title="Bootstrap" target="_blank">Bootstrap</a> &amp;
    <a href="https://highlightjs.org/" title="highlight.js" target="_blank">highlight.js</a>

    <span class="socials">
      <a href="https://github.com/Giuseppe-Mazzapica" title="GitHub" target="_blank"><i class="fa fa-github-alt"></i></a>
      <a href="https://twitter.com/gmazzap" title="Twitter" target="_blank"><i class="fa fa-twitter"></i></a>
      <a href="http://wordpress.stackexchange.com/users/35541/" title="Stack Exchange" target="_blank"><i class="fa fa-stack-exchange"></i></a>
    </span> -->
    <div class="container-fluid">
      <p>Copyright @ 2015-2016 Dasudian.com.All rights reserved</p>
    </div>
  </footer>

  <a href="#wrapper" class="hidden-xs hidden-sm" id="back-top" title="Back to top"><i class="fa fa-long-arrow-up"></i></a>
  <script src="http://docs.dasudian.com/js/highlight.min.js"></script>
  <script src="http://docs.dasudian.com/js/theme.min.js"></script>

  
</body>

</html>
