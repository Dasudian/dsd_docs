<!DOCTYPE html>
<html lang="zh">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="大数点物联网开发者平台文档，基于大数点物联网平台，帮助开发者快速构建物联网应用">
    <title>IM Android集成</title>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/app.css" rel="stylesheet">
    <link href="/css/doc.css" rel="stylesheet">
    <link href="//cdn.bootcss.com/highlight.js/9.2.0/styles/dark.min.css" rel="stylesheet">
    <script src="/js/jquery.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/common.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script>
    <script>
      $(function() {
        // $(".document .side_left ul li a").click(function() {
        //   $(".document .side_left ul li a").removeClass("active");
        //   $(this).addClass("active");
        // })
        $(".menu1>li>a.fold").click(function(){
				  $(".menu1 a.fold").css("background-image","url(/images/number_down.png)");
				  $(".menu2,.menu3").slideUp();
			  })
			  $(".menu2>li>a.fold").click(function(){
          $(".menu2 a.fold").css("background-image","url(/images/number_down.png)");
          $(".menu3").slideUp();
        })
        $(".fold").click(function() {
          if ($(this).next("ul").is(":hidden")) {
            $(this).css("background-image", "url(/images/number_up.png)");
            $(this).next("ul").slideDown();
          } else {
            $(this).css("background-image", "url(/images/number_down.png)");
            $(this).next("ul").slideUp();
          }
        })
      })
      $(function(){
			  $(".side_right").scroll( function() { 
				  var scrollValue=$(".side_right").scrollTop();
				  scrollValue > 100 ? $('div[class=scroll]').fadeIn():$('div[class=scroll]').fadeOut();
			  });	
			  $('#scroll').click(function(){
				  $(".side_right").animate({scrollTop:0},200);	
			  });	
		  })
    </script>
    <link href='//fonts.useso.com/css?family=Open+Sans:300|Source+Code+Pro:400' rel='stylesheet' type='text/css'>
  </head>

  <body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://dev.dasudian.com"><img src="/images/logo.png"/></a>
        </div>

        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://www.dasudian.com/service.html"  target="_blank" >产品服务</a></li>
            <li><a href="https://www.dasudian.com/solution.html"  target="_blank" >解决方案</a></li>
            <li><a href="https://www.dasudian.com/support.html"  target="_blank" >技术支持</a></li>
            <li><a href="https://www.dasudian.com/contact.html"  target="_blank" >联系我们</a></li>
            <li><a href="https://www.dasudian.com/about.html"  target="_blank" >关于我们</a></li>
            <!-- <li><a href="https://dev.dasudian.com/login/view" class="btn-small" target="_blank">登录</a></li>
            <li><a href="https://dev.dasudian.com/sign_up/view" class="btn-small" target="_blank">注册</a></li> -->
          </ul>
        </div>
      </div>
    </nav>

    <div class="container-fluid0 document">
      <div class="side_left">
        <ul class="menu1">
          <li><a class="fold">大数点物联网平台</a>
            <ul class="menu2" >
              <li><a id="intro-index" class="" href="/dsd-intro/index.html">工业物联网平台介绍</a></li>
            </ul>
          </li>
          <li><a class="fold">IoT DataHub</a>
            <ul class="menu2" >
              <li><a id="datahub-index" class="" href="/dsd-datahub/">Overview</a></li>
              <li><a class="fold">SDK</a>
                <ul class="menu3" >
                  <li><a id="datahub-sdk-embededc" class="" href="/dsd-datahub/sdk/embeded_c.html">Embeded C</a></li>
                  <li><a id="datahub-sdk-csharp" class="" href="/dsd-datahub/sdk/csharp.html">C#</a></li>
                  <li><a id="datahub-sdk-java" class="" href="/dsd-datahub/sdk/java.html">Java</a></li>
                  <li><a id="datahub-sdk-js" class="" href="/dsd-datahub/sdk/javascript.html">JavaScript</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><a class="fold">DSD Database (DSDB)</a>
            <ul class="menu2" >
              <li><a id="dsdb-index" class="" href="/dsd-dsdb/">DSDB Overview</a></li>
              <li><a class="fold">Introduction</a>
                <ul class="menu3" >
                  <li><a id="dsdb-intro-overview" class="" href="/dsd-dsdb/introduction/index.html">Overview</a></li>
                  <li><a id="dsdb-intro-installation" class="" href="/dsd-dsdb/introduction/installation.html">Installation</a></li>
                  <li><a id="dsdb-intro-start" class="" href="/dsd-dsdb/introduction/getting_started.html">Getting Started</a></li>
                </ul>
              </li>
              <li><a class="fold">Administration</a>
                <ul class="menu3" >
                  <li><a id="dsdb-admin-overview" class="" href="/dsd-dsdb/administration/index.html">administration Overview</a></li>
                  <li><a id="dsdb-authent&amp;authori" class="" href="/dsd-dsdb/administration/authentication_and_authorization.html">Authentication&Authorization</a></li>
                  <li><a id="dsdb-backup&amp;restore" class="" href="/dsd-dsdb/administration/backup_and_restore.html">Backup&Restore</a></li>
                  <li><a id="dsdb-configuration" class="" href="/dsd-dsdb/administration/config.html">Configuration</a></li>
                  <li><a id="dsdb-logs" class="" href="/dsd-dsdb/administration/logs.html">Logs</a></li>
                  <li><a id="dsdb-monitoring" class="" href="/dsd-dsdb/administration/statistics.html">Server Monitoring</a></li>
                  <li><a id="dsdb-upgrade" class="" href="/dsd-dsdb/administration/upgrading.html">Upgrading</a></li>
                </ul>
              </li>
              <li><a class="fold">Clients</a>
                <ul class="menu3" >
                  <li><a id="dsdb-clients-overview" class="" href="/dsd-dsdb/clients/index.html">Clients Overview</a></li>
                  <li><a id="dsdb-clients-httpapi" class="" href="/dsd-dsdb/clients/api.html">HTTP API</a></li>
                </ul>
              </li>
              <li><a class="fold">Concepts</a>
                <ul class="menu3" >
                  <li><a id="dsdb-concepts-overview" class="" href="/dsd-dsdb/concepts/index.html">Concepts Overview</a></li>
                  <li><a id="dsdb-key-concepts" class="" href="/dsd-dsdb/concepts/key_concepts.html">Key Concepts</a></li>
                  <li><a id="dsdb-concepts-arch" class="" href="/dsd-dsdb/concepts/how_dsdb_works.html">Architecture</a></li>
                  <li><a id="dsdb-concepts-schema-data-layout" class="" href="/dsd-dsdb/concepts/schema_and_data_layout.html">Scheam Design</a></li>
                  <li><a id="dsdb-concepts-insights-tradeoffs" class="" href="/dsd-dsdb/concepts/insights_tradeoffs.html">Insights Tradeoffs</a></li>
                  <li><a id="dsdb-concepts-api-endpoints" class="" href="/dsd-dsdb/concepts/api.html">API Endpoints&Ports</a></li>
                  <li><a id="dsdb-concepts-storage-engine" class="" href="/dsd-dsdb/concepts/storage_engine.html">Storage Engine</a></li>
                  <li><a id="dsdb-concepts-glossary" class="" href="/dsd-dsdb/concepts/glossary.html">Glossary of Terms</a></li>
                  <li><a id="dsdb-concepts-vs-sql" class="" href="/dsd-dsdb/concepts/crosswalk.html">Comparison to SQL</a></li>
                </ul>
              </li>
              <li><a class="fold">Data Sources</a>
                <ul class="menu3" >
                  <li><a id="dsdb-datasource-diamond" class="" href="/dsd-dsdb/data_sources/diamond.html">Diamond</a></li>
                  <li><a id="dsdb-datasource-opentsdb" class="" href="/dsd-dsdb/data_sources/opentsdb.html">OpenTSDB</a></li>
                </ul>
              </li>
              <li><a class="fold">Guides</a>
                <ul class="menu3" >
                  <li><a id="dsdb-guides-clustering" class="" href="/dsd-dsdb/guides/clustering.html">Clustering</a></li>
                  <li><a id="dsdb-guides-ddr" class="" href="/dsd-dsdb/guides/downsampling_and_retention.html">Downsampling and Data Retention</a></li>
                  <li><a id="dsdb-guides-hsg" class="" href="/dsd-dsdb/guides/hardware_sizing.html">Hardware Sizing Guidelines</a></li>
                  <li><a id="dsdb-guides-querying" class="" href="/dsd-dsdb/guides/querying_data.html">Querying Data</a></li>
                  <li><a id="dsdb-guides-writing" class="" href="/dsd-dsdb/guides/writing_data.html">Writing Data</a></li>
                </ul>
              </li>
              <li><a class="fold">Query Language</a>
                <ul class="menu3" >
                  <li><a id="dsdb-querylang-overview" class="" href="/dsd-dsdb/query_language/index.html">Overview</a></li>
                  <li><a id="dsdb-querylang-dataexp" class="" href="/dsd-dsdb/query_language/data_exploration.html">Data Exploration</a></li>
                  <li><a id="dsdb-querylang-scheamexp" class="" href="/dsd-dsdb/query_language/schema_exploration.html">Schema Exploration</a></li>
                  <li><a id="dsdb-querylang-func" class="" href="/dsd-dsdb/query_language/functions.html">Functions</a></li>
                  <li><a id="dsdb-querylang-contq" class="" href="/dsd-dsdb/query_language/continuous_queries.html">Continuous Queries</a></li>
                  <li><a id="dsdb-querylang-spec" class="" href="/dsd-dsdb/query_language/spec.html">Query Language Reference</a></li>
                  <li><a id="dsdb-querylang-mgmt" class="" href="/dsd-dsdb/query_language/database_management.html">Database Management</a></li>
                  <li><a id="dsdb-querylang-math" class="" href="/dsd-dsdb/query_language/math_operators.html">Mathematical Operators</a></li>
                </ul>
              </li>
              <li><a class="fold">Sample Data</a>
                <ul class="menu3" >
                  <li><a id="dsdb-sampledata-down" class="" href="/dsd-dsdb/sample_data/data_download.html">Sample Data Download</a></li>
                </ul>
              </li>
              <li><a class="fold">Tools</a>
                <ul class="menu3" >
                  <li><a id="dsdb-tools-overview" class="" href="/dsd-dsdb/tools/index.html">Tools Overview</a></li>
                  <li><a id="dsdb-tools-shell" class="" href="/dsd-dsdb/tools/shell.html">CLI/Shell</a></li>
                  <li><a id="dsdb-tools-webadmin" class="" href="/dsd-dsdb/tools/web_admin.html">Web Admin Interface</a></li>
                </ul>
              </li>
              <li><a class="fold">Write Protocols</a>
                <ul class="menu3" >
                  <li><a id="dsdb-writepro-overview" class="" href="/dsd-dsdb/write_protocols/">Overview</a></li>
                  <li><a id="dsdb-writepro-line" class="" href="/dsd-dsdb/write_protocols/line.html">Line Protocol</a></li>
                  <li><a id="dsdb-writepro-syntax" class="" href="/dsd-dsdb/write_protocols/write_syntax.html">Write Syntax</a></li>
                  <li><a id="dsdb-writepro-json" class="" href="/dsd-dsdb/write_protocols/json.html">JSON Protocol</a></li>
                  <li><a id="dsdb-writepro-udp" class="" href="/dsd-dsdb/write_protocols/udp.html">Service - UDP</a></li>
                  <li><a id="dsdb-writepro-graphite" class="" href="/dsd-dsdb/write_protocols/graphite.html">Service - Graphite</a></li>
                  <li><a id="dsdb-writepro-opentsdb" class="" href="/dsd-dsdb/write_protocols/opentsdb.html">Servcie - OpenTSDB</a></li>
                  <li><a id="dsdb-writepro-collectd" class="" href="/dsd-dsdb/write_protocols/collectd.html">Service - CollectD</a></li>
                </ul>
              </li>
              <li><a class="fold">Troubleshooting</a>
                <ul class="menu3" >
                  <li><a id="dsdb-troubleshoot-overview" class="" href="/dsd-dsdb/troubleshooting/index.html">Troubleshooting Overview</a></li>
                  <li><a id="dsdb-troubleshoot-fei" class="" href="/dsd-dsdb/troubleshooting/frequently_encountered_issues.html">Frequently Encountered Issues</a></li>
                  <li><a id="dsdb-troubleshoot-monitor" class="" href="/dsd-dsdb/troubleshooting/system_monitoring.html">System Monitoring</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><a class="fold">DSD API Container (DAC)</a>
            <ul class="menu2" >
              <li><a id="dac-index" class="" href="/dsd-dac/">DAC介绍</a></li>
              <li><a id="dac-java-api" class="" href="/dsd-dac/dac_cloud_api_java.html">DAC Java API</a></li>
              <li><a id="dac-c-api" class="" href="/dsd-dac/dac_cloud_api_c.html">DAC C API</a></li>
              <li><a id="dac-cpp-api" class="" href="/dsd-dac/dac_cloud_api_cpp.html">DAC C++ API</a></li>
            </ul>
          </li>
          <li><a class="fold">IM &amp; Push Cloud</a>
            <ul class="menu2" style="display: block;">
              <li><a id="im-index" class="" href="/dsd-im/">IM服务介绍</a></li>
              <li><a id="im-android" class="active" href="/dsd-im/integrate-im-android.html">Android上集成IM服务</a></li>
              <li><a id="im-ios" class="" href="/dsd-im/integrate-im-ios.html">iOS上集成IM服务</a></li>
              <li><a id="im-linux" class="" href="/dsd-im/integrate-im-linux.html">Linux上集成IM服务</a></li>
            </ul>
          </li>
          <li><a class="fold">MQ Cloud</a>
            <ul class="menu2" >
              <li><a id="mq-index" class="" href="/dsd-mq/">MQ服务介绍</a></li>
              <li><a id="mq-android" class="" href="/dsd-mq/integrate-mq-android.html">Android上集成MQ服务</a></li>
              <li><a id="mq-ios" class="" href="/dsd-mq/integrate-mq-ios.html">iOS上集成MQ服务</a></li>
              <li><a id="mq-linux" class="" href="/dsd-mq/integrate-mq-linux.html">Linux上集成MQ服务</a></li>
            </ul>
          </li>
          <li><a class="fold">大数点云账户管理AAA Cloud</a>
            <ul class="menu2" >
              <li><a id="aaa-index" class="" href="/dsd-aaa/">AAA简介</a></li>
              <li><a id="aaa-android" class="" href="/dsd-aaa/dev-guide-android.html">Android上集成AAA服务</a></li>
              <li><a id="aaa-ios" class="" href="/dsd-aaa/dev-guide-ios.html">iOS上集成AAA服务</a></li>
              <li><a id="aaa-api" class="" href="/dsd-aaa/aaa-api.html">REST API</a></li>
            </ul>
          </li>
          <li><a class="fold">大数点云存储CloudFile</a>
            <ul class="menu2" >
              <li><a id="cf-index" class="" href="/dsd-cloudfile/">CloudFile介绍</a></li>
              <li><a id="cf-android" class="" href="/dsd-cloudfile/dev-guide-android.html">Android上集成CloudFile服务</a></li>
              <li><a id="cf-ios" class="" href="/dsd-cloudfile/dev-guide-ios.html">iOS上集成CloudFile服务</a></li>
              <li><a id="cf-api" class="" href="/dsd-cloudfile/cf-api.html">REST API</a></li>
            </ul>
          </li>
        </ul>
    </div>

    <div class="side_right">
      <div class="doc">
        <h1 id="androidim">Android上集成IM服务</h1>
<h2 id="">集成前准备</h2>
<p>到<a href="https://dev.dasudian.com">大数点开发者平台</a>注册成为大数点合作伙伴并创建应用，每创建一个应用大数点平台会为其生成一个AppID和AppSec，AppID在大数点平台唯一标识一个应用，而AppSec可以被更新。AppID和AppSec将在您的代码里使用，保证您的应用与大数点平台间的安全传输。</p>
<p>若您还没有注册，请使用如下Demo App作测试：</p>
<p>Demo App:</p>
<pre><code>AppID: 9_9AFja3v8muZumgSuiu_A
AppKey: e844ae089ce9ccc0</code></pre>
<h2 id="sdk">下载SDK</h2>
<p>到<a href="http://main.dasudian.com/downloads/sdk/latest/im-sdk-android.zip">大数点官网</a>下载IM SDK.</p>
<h2 id="sdk-1">SDK内容</h2>
<ul>
<li>dsd-lib-IM.jar</li>
<li>libdsd_im.so</li>
</ul>
<h2 id="-1">配置工程</h2>
<h3 id="jar">导入库和jar包</h3>
<p>拷贝libdsd_im.so到libs/armeabi目录下，如果没有armeabi目录，请手动创建该目录。
拷贝dsd-lib-IM.jar到libs目录下。</p>
<h3 id="-2">配置权限</h3>
<p>在AndroidManifest.xml中加入如下内容使能必要的访问权限.</p>
<pre><code class="language-xml">&lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" /&gt;
&lt;uses-permission android:name="android.permission.INTERNET" /&gt;
&lt;uses-permission android:name="android.permission.READ_PHONE_STATE" /&gt;
&lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /&gt;</code></pre>
<h2 id="sdk-2">初始化SDK</h2>
<h3 id="dsdimclient">获取DsdIMClient实例</h3>
<pre><code>DsdIMClient dsdIMClient = DsdIMClient.getInstance();</code></pre>
<h3 id="callback">设置callback接口</h3>
<pre><code>void setDsdIMCallback(DsdIMClientInterface dsdIMClientCallback)</code></pre>
<h3 id="-3">实现接口回调函数</h3>
<pre><code>class ReceiveMsg implements DsdIMClientInterface {

        @Override
        public void onReceivedMsg(String content) {
        }

        @Override
        public void onReconnectSuccess() {
        }

        @Override
        public void onConnectionLost() {
        }

        @Override
        public void onLoginOnAnotherClient() {
        }

        @Override
        public void onGroupMuted(String content) {
        }

        @Override
        public void onGroupUnmuted(String content) {
        }

        @Override
        public void onSystemGroupMsg(String content) {
        }
    }</code></pre>
<p>onReceivedMsg消息</p>
<pre><code>{
    "d":"0|1|2",  //0-单播，1-组播，2-广播
    "f":"5289bb2a-cc53-4ad8-9a30-161b1aa680c7",  // 消息发送者
    "g":"101_9AMQjXqiPkvgRKEef2_5289bb2a-cc53-4ad8-9a30-161b1aa680c7_1470291003", // groupId
    "m": 
    {
        "b":"content", // 消息内容
        "t":"1|2|3|4" //消息类型,0-text,1-image,3-audio,4-video
    }, 
    "i":"6", // msgid
    "t":"1470291040" // 消息时间戳
}</code></pre>
<p>onGroupMuted消息</p>
<pre><code>{
    "d" :"25" //dsdmethod 禁言
    "f":"ocean" //fromuser
    "g":"1001" //groupid
    "ts”: xxxxx //timestamp
}</code></pre>
<p>onGroupUnmuted消息</p>
<pre><code>{
    "d" :"28" //dsdmethod 取消禁言
    "f":"ocean" //fromuser
    "g":"1001" //groupid
    "ts”: xxxxx //timestamp
}</code></pre>
<p>onSystemGroupMsg消息</p>
<pre><code>{
    "d":"38",               //dsdmethod  
    "f":"Dasudian",         //fromuser  
    "t":"14645433534",      //timestamp  
    "m":{                   //msg body  
        "t":1,              //Notification-type(1:群内踢人，2：解散群组，3：离开群组，4：加入群组,5：群内文本消息)  
        "g":"gid1234567",   //group id  
        "u":"U1"            //UserId,被操作的对象（群成员操作时才有,比如'当t=1时，表示被踢的UserID；当t=2，可以不传；当t=3/4时，表示离开/加入的UserId'）  
        "b":"This is text content" //文本消息的具体内容（当t=5时，才有该字段）
    }  
}</code></pre>
<h3 id="-4">链接服务器</h3>
<pre><code class="language-java">/**
 * 初始化sdk并链接服务器。
 * @param  serverAddress  服务器地址，为空则默认使用大数点提供的公有云服务
 * @param  version      "1.0"
 * @param  appID        app的id，在大数点开发者平台创建应用时获得
 * @param  appSec       app秘钥，在大数点开发者平台创建应用时获得
 * @param  userId       用户名,用户身份唯一标识
 *                      传null表示不统计，或者传一个用户信息的JSON，比如{"name":"jack","gender":"male","region":"Beijing"}
 * @param  clientId     客户端的唯一id，用于服务器向客户端推送消息
 * @param  option       可选的用户信息，用于后台统计；
 * @return              成功:0,失败:-1
 */
int dsdInit(String serverAddress, String version,
            String appId, String appSec, String userId, String clientId,
            String option);</code></pre>
<h3 id="-5">设置用户信息</h3>
<p>在连接服务器成功后，发送消息前，需要先设置用户个人信息。</p>
<pre><code class="language-java">/**
 * 设置用户信息
 * @param userid     用户唯一id
 * @param nickname   用户昵称
 * @param avatarurl  用户头像url
 * @param location   用户所在地区
 * @param sex        用户性别,0:男,1:女
 * @param signature  用户签名
 * @return           成功：0，失败：返回错误码
 */
int dsdSetUserInfo(String userid, String nickname, String avatarurl, String location, int sex, String signature);</code></pre>
<h2 id="-6">发送单播消息</h2>
<p>注意：
1.使用大数点公有云服务器，非VIP用户可以发送的最大消息长度为1024个字节。
2.所有发送消息相关的函数，消息都必须以如下JSON格式发送。</p>
<pre><code>{"t":"0|1|2|3|4","b":"msg content"}
@t： Message Type
    0 text
    1 image
    2 audio
    3 video
    4 HTML5 page
@b： 消息内容,如果消息为image或audio等多媒体消息，则为该多媒体的URL。</code></pre>
<pre><code class="language-java">/**
 * 同步单播消息.该函数会阻塞到收到服务器的ack或者超时后返回.
 * @param  from       发送消息的人
 * @param  toUser     目标用户列表
 * @param  msg        消息内容,必须为JSON格式
 * @return            成功:0,失败:查看失败码
 */
int dsdSendWithAck(String from, String toUser, String msg)；</code></pre>
<h2 id="-7">发送组播消息</h2>
<pre><code class="language-java">/**
 * 同步的发送组播消息,该函数会阻塞到收到服务器的ack或者超时后返回.
 * @param  user    发送者
 * @param  groupid 组id
 * @param  msg     消息内容
 * @return         成功:0,失败:查看失败码
 */
int dsdMulticastwithAck(String user, String groupid, String msg)；</code></pre>
<h2 id="-8">发送广播消息</h2>
<pre><code class="language-java">/**
 * 异步的发送广播消息,该函数不会阻塞调用者.
 * @param user  发送者
 * @param msg   消息内容
 */
int dsdBroadcastWithAck(String user, String msg);</code></pre>
<h2 id="-9">创建组</h2>
<pre><code class="language-java">/**
 * 创建组播组,该函数会阻塞到收到服务器的ack或者超时后返回.
 * @param  user      用户名
 * @return           成功:返回组播组的id,失败:NULL
 */
String dsdCreateGroup(String user);</code></pre>
<p>返回格式</p>
<pre><code>{
    "d" :"10" //dsdmethod
    "s" : 0//status 0000：成功, 1XXX： 失败
    ”g":”1111” //groupid
    "i":"xxxx"//msgid
｝</code></pre>
<h2 id="-10">加入组</h2>
<pre><code class="language-java">/**
 * 加入组播组,该函数会阻塞到收到服务器的ack或者超时后返回.
 * @param  user    用户名
 * @param  groupId 可以指定一个groupId，如果这个组不存在，服务器会创建一个组
 * @param  groupName  和这个groupId绑定的gorup名字
 * @return         成功:0,失败:查看失败码
 */
int dsdJoinGroup(String user, String groupId, String groupName);</code></pre>
<h2 id="-11">离开组</h2>
<pre><code class="language-java">/**
 * 离开组播组,该函数会阻塞到收到服务器的ack或者超时后返回.
 * @param  user    离开的用户
 * @param  groupid dsdCreateGroup函数返回的组播组id
 * @return         成功:0,失败:查看失败码
 */
int dsdLeaveGroup(String user, String groupId);</code></pre>
<h2 id="-12">将某人踢出组</h2>
<pre><code class="language-java">/**
 * 将某人踢出组播组,该函数会阻塞到收到服务器的ack或者超时后返回.
 * @param  user        组播组拥有者
 * @param  groupId     dsdCreateGroup函数返回的组播组id
 * @param  groupMember 要踢出的人
 * @return             成功:0,失败:查看失败码
 */
int dsdKickOutOfGroup(String user, String groupId, String groupMember)</code></pre>
<h2 id="-13">组内将某人禁言</h2>
<pre><code class="language-java">/**
 * 组内将某人禁言
 * @param user          创建组的人
 * @param groupId       组id
 * @param groupMember   被禁言人
 * @return              成功:0,失败:查看失败码
 */
int dsdMuteGroup(String user, String groupId,
        String groupMember);</code></pre>
<h2 id="-14">组内取消对某人的禁言</h2>
<pre><code class="language-java">/**
 * 组内取消对某人的禁言
 * @param user          创建组的人
 * @param groupId       组id
 * @param groupMember   组成员
 * @return              成功:0,失败:查看失败码
 */
int dsdUnmuteGroup(String user, String groupId,
        String groupMember);</code></pre>
<h2 id="-15">将某人加入黑名单</h2>
<pre><code class="language-java">/**
 * 将某人加入黑名单
 * @param sourceUser  用户
 * @param targetUser  将谁加入黑名单
 * @return            成功:0,失败:查看失败码
 */
int dsdAddToBlackList(String sourceUser, String targetUser);</code></pre>
<h2 id="-16">将某人从黑名单移除</h2>
<pre><code class="language-java">/**
 * 将某人从黑名单移除
 * @param sourceUser 用户
 * @param targetUser 要移除的人
 * @return  成功:0,失败:查看失败码
 */
int dsdRemoveFromBlackList(String sourceUser,
        String targetUser);</code></pre>
<h2 id="-17">获取当前所有的组</h2>
<pre><code class="language-java">/**
 * 获取当前所有的组
 * @param user  用户名
 * @return 成功：返回所有的组，失败：null
 */
String dsdGetAllGroupList(String user);</code></pre>
<p>返回格式</p>
<pre><code>{
    "d" :"36" //dsdmethod
    "s" :0000 //status 0000：成功, 1XXX: 失败
    ”gl“:[]//group list
    "i”:　"xx " //msgid
｝</code></pre>
<h2 id="-18">获取某个组内所有的成员</h2>
<pre><code class="language-java">/**
 * 获取某个组内所有的成员
 * @param user      用户名
 * @param groupid   组id
 * @return   成功：返回所有的成员，失败：null
 */
String dsdGetGroupMemberList(String user, String groupid);</code></pre>
<p>返回格式</p>
<pre><code>{
    "d" :"34" //dsdmethod
    "s" :0000 //status 0000：成功, 1XXX: 失败
    ”gml“:[]//group member list
    "i”:　"xx " //msgid
｝</code></pre>
<h2 id="-19">添加组管理员</h2>
<pre><code>/**
 * 添加组管理员
 * @param owner    组拥有者
 * @param groupId  组id
 * @param userId   组成员
 * @return         成功:0,失败:查看失败码
 */
int dsdAddGroupManager(String owner, String groupId, String userId);</code></pre>
<h2 id="-20">移除组管理员</h2>
<pre><code>/**
 * 移除组管理员
 * @param owner   组拥有者
 * @param groupId 组id
 * @param userId  组成员
 * @return        成功:0,失败:查看失败码
 */
int dsdRemoveGroupManager(String owner, String groupId, String userId);</code></pre>
<h2 id="-21">获取组管理员列表</h2>
<pre><code>/**
 * 获取组管理员列表
 * @param owner   组拥有者
 * @param groupId 组id
 * @return        成功：返回所有的成员，失败：null
 */
String dsdGetGroupManagerList(String owner, String groupId);</code></pre>
<p>返回的组管理员列表格式</p>
<pre><code>{
    "d" :"44" //dsdmethod
    "s" :0000 //status 0000：成功, 1XXX: 失败
    ”gml“:[]//group manager list
    "i”:　"xx " //msgid
｝</code></pre>
<h2 id="-22">获取历史消息</h2>
<pre><code>/**
 * 获取历史消息
 * @param userId   对方的名字
 * @param count    获取条数,0：全部，num：num条历史消息
 * @return         成功：返回json，失败：null
 */
String dsdGetHistoryMessage(String userId, int count);</code></pre>
<p>成功时消息格式：</p>
<pre><code>{
    "d" :"100" //dsdmethod
    "s" :0000 //status 0000：成功, 1XXX: 失败
    "ml":[]//msg list
    "i”:　"xx " //msgid
｝</code></pre>
<h2 id="-23">清除历史消息</h2>
<pre><code>/**
 * 清除历史消息
 * @param userId  对方的名字
 * @param type    0：清除所有的历史消息，1：清除msgIdList里面的消息
 * @param msgIdList  json数组
 * @return        成功:0,失败:查看失败码
 */
int dsdClearHistoryMessage(String userId, int type, String msgIdList);</code></pre>
<h2 id="-24">获取未读消息</h2>
<pre><code>/**
 * 获取未读消息
 * @return 成功返回json，失败返回null
 */
public native String dsdGetUnreadMessage();</code></pre>
<p>成功时返回的消息格式：</p>
<pre><code>{
  "d" :"102" //dsdmethod
  "s" :0000 //status 0000：成功, 1XXX: 失败
  "i”:　"xx " //msgid
  “ml”: [] // message list
｝</code></pre>
<h2 id="-25">忽略未读消息</h2>
<pre><code>/**
 * 忽略未读消息
 * @param type          0：忽略全部未读消息，1：忽略部分未读
 * @param userIdList    当type为0时，传null；当type为1时，传要忽略的好友的消息id，格式为json数组
 *                      ["userId1","userId2",...]
 * @return              成功:0,失败:查看错误码
 */
public native int dsdIgnoreUnreadMessages(int type, String userIdList);</code></pre>
<h2 id="-26">消息设置为已读</h2>
<pre><code>/**
 * 设置消息为已读
 * @param userId    好友的id
 * @return          成功:0,失败:查看错误码
 */
public native int dsdSendMessageReceipt(String userId);</code></pre>
<h2 id="-27">退出登录</h2>
<pre><code>/**
 * 退出登录，切换用户时调用
 * @param user 用户
 * @return      成功：0，失败：查看错误列表
 */
int dsdSignOut(String user);</code></pre>
<h2 id="-28">与服务器断开链接</h2>
<pre><code class="language-java">/**
 * 退出登陆，调用该函数后将不会收到服务器的推送消息。
 */
void dsdDisconnect();</code></pre>
<h2 id="error-code">ERROR CODE</h2>
<pre><code>客户端错误码
2000-非法参数
2001-已经初始化了
2002-客户端初始化失败
2003-连接服务器失败
2004-连接服务器失败
2005-连接服务器超时
2006-发送消息超时
2007-发送的消息太大
2008-发送的消息不是json格式
2009-分配内存失败
2010-服务器未连接

服务器端错误码
0000-成功
1000-系统错误
1001-被禁言
1002-权限不够，操作被拒绝
1003-目标不存在
1004-被拉黑
1005-你已经是群成员，不能重复加入
1006-消息存在敏感词，不允许发送
1007-无效的JSON数据结构
1008-未知的Method
1009-要操作的Group不存在
1010-不是群内成员
1011-要操作的GroupID为空</code></pre>
<h2 id="android">下载Android示例程序</h2>
<p><a href="https://www.github.com/Dasudian/imsdk-example-android">下载Android示例程序</a></p>
      </div>

              <div class="tract"><img src="/images/tract.png"/></div>
            <div class="clearfix"></div>
      <div class="scroll" id="scroll" style="display:none;">
			     <img src="/images/top.png"/>
		  </div>
    </div>
  </div>
  <script>hljs.initHighlightingOnLoad();</script>
</body>

</html>
